[DEBUG] 临时目录已设置为：/home/Yxwxwx/code/dmet/test/large_44/tmp_64631
#INFO: **** input file is /home/Yxwxwx/code/dmet/test/large_44/dmet_siso.py ****
from pyscf import gto, scf, ao2mo, mcscf, fci, dmrgscf, lib
# from pyscf.csf_fci import csf_solver  # TODO:
from pyscf.mcscf import avas
from pyscf.tools import molden, fcidump
from pyscf.lib import logger, cho_solve
from pyscf.data import nist
import numpy as np
import scipy
from functools import reduce
import os
import tempfile
from liblan.utils.rdiis import tag_rdiis_

dmrgscf.settings.BLOCKEXE = os.popen("which block2main").read().strip()
dmrgscf.settings.MPIPREFIX = " "

def set_custom_tmpdir(workdir):
    # 动态获取Slurm分配的作业ID（当在Slurm环境下运行时）
    slurm_job_id = os.getenv('SLURM_JOB_ID', 'localrun')
    
    # 构建唯一临时目录路径
    custom_tmp = os.path.abspath( 
        os.path.join(workdir, f"tmp_{slurm_job_id}") 
    )
    
    # 确保目录存在
    os.makedirs(custom_tmp, exist_ok=True)
    
    # 双重配置方案：修改PySCF参数 + 重定向环境变量
    lib.param.TMPDIR = custom_tmp
    os.environ['TMPDIR'] = custom_tmp  # 覆盖系统环境变量
    tempfile.tempdir = custom_tmp      # 影响Python标准库的临时文件
    
    print(f"[DEBUG] 临时目录已设置为：{custom_tmp}")

current_workdir = os.path.dirname(os.path.abspath(__file__))
set_custom_tmpdir(current_workdir)
def read_cas_info(fname):
    with open(fname, "r") as f1:
        ncasorb, ncaselec = [int(x) for x in f1.readline().split(" ")]
        casorbind = [int(x) for x in f1.readline().split(" ")]
        statelis = [int(x) for x in f1.readline().split(" ")]
    return ncasorb, ncaselec, casorbind, statelis


def rohf_solve_imp(hcore, eris, nelec, spin, max_mem, dm0=None, verbose=logger.INFO):
    mol = gto.M()
    mol.verbose = verbose
    mol.incore_anyway = True
    mol.nelectron = nelec
    mol.spin = spin

    nao = hcore.shape[0]
    print("nao = ", nao)
    print("nelec = ", mol.nelec)

    mf = scf.rohf.ROHF(mol).x2c()
    mf.max_memory = max_mem
    mf.mo_energy = np.zeros((nao))
    mf.max_cycle = 1000
    mf.diis_space = 8
    mf.init_guess = "1e"
    mf.level_shift = 0.2

    mf.get_hcore = lambda *args: hcore
    mf.get_ovlp = lambda *args: np.eye(nao)
    mf._eri = ao2mo.restore(8, eris, nao)

    if dm0 is None:
        mf.kernel()
    else:
        if dm0.shape != hcore.shape:
            bath_size = hcore.shape[0] - dm0.shape[0]
            dm0 = scipy.linalg.block_diag(
                dm0, np.eye(bath_size) * (nelec - np.trace(dm0)) / bath_size
            )
        mf.kernel(dm0)
    return mf


def sacasscf_solve_imp(
    solver_base, mol, ncasorb, ncaselec, casorbind, statelis, avas=False
):
    solver = mcscf.CASSCF(solver_base, ncasorb, ncaselec)

    if avas:
        mo = casorbind
    else:
        mo = solver.sort_mo(casorbind)
    mcfs = []
    logger.info(solver, "Attempting SA-DMRGSCF with")
    for i in range(len(statelis)):
        if statelis[i] != 0:
            new_mcf = dmrgscf.DMRGCI(mol, maxM=1500, tol=1e-10)
            new_mcf.spin = i
            new_mcf.nroots = statelis[i]
            new_mcf.threads = 16
            new_mcf.memory = int(mol.max_memory / 1000)
            new_mcf.block_extra_keyword = [
                "real_density_matrix",
                "davidson_soft_max_iter 1600",
                "noreorder",
                "cutoff 1E-24",
            ]
            new_mcf.runtimeDir = lib.param.TMPDIR + "/%d" % i
            new_mcf.scratchDirectory = lib.param.TMPDIR + "/%d" % i
            mcfs.append(new_mcf)
            logger.info(
                solver, "%s states with spin multiplicity %s", statelis[i], i + 1
            )

    statetot = sum(statelis)
    mcscf.state_average_mix_(solver, mcfs, np.ones(statetot) / statetot)
    solver.run(mo, verbose=mol.verbose)
    return solver


def lowdin(s):
    """new basis is |mu> c^{lowdin}_{mu i}"""
    e, v = scipy.linalg.eigh(s)
    idx = e > 1e-15
    return np.dot(v[:, idx] / np.sqrt(e[idx]), v[:, idx].conj().T)


def caolo(s):
    return lowdin(s)


def cloao(s):
    return lowdin(s) @ s


def get_dmet_as_props(mf, imp_inds, lo_meth="lowdin", thres=1e-13):
    """
    Returns C(AO->AS), entropy loss, and orbital composition
    """
    s = mf.get_ovlp()
    caolo_mat, cloao_mat = caolo(s), cloao(s)
    env_inds = [x for x in range(s.shape[0]) if x not in imp_inds]

    if mf.mol.spin == 0:
        pass
    else:
        dma, dmb = mf.make_rdm1()

        ldma = reduce(np.dot, (cloao_mat, dma, cloao_mat.conj().T))
        ldmb = reduce(np.dot, (cloao_mat, dmb, cloao_mat.conj().T))

        ldma_env = ldma[env_inds, :][:, env_inds]
        ldmb_env = ldmb[env_inds, :][:, env_inds]

        nat_occa, nat_coeffa = np.linalg.eigh(ldma_env)
        nat_occb, nat_coeffb = np.linalg.eigh(ldmb_env)

        ldmr_env = ldma_env + ldmb_env
        nat_occr, nat_coeffr = np.linalg.eigh(ldmr_env)

        caoas = np.hstack([caolo_mat[:, imp_inds], caolo_mat[:, env_inds] @ nat_coeffr])

        nuu = np.sum([nat_occr < thres])
        ne = np.sum([(nat_occr >= thres) & (nat_occr <= 2 - thres)])
        nuo = np.sum([nat_occr > 2 - thres])

        asorbs = (nuu, ne, nuo)
        print("caoas.shape = ", caoas.shape)
        print("asorbs = ", asorbs)

        nat_occa = nat_occa[nat_occa > thres]
        nat_occb = nat_occb[nat_occb > thres]
        nat_occr = nat_occr[nat_occr > thres]

        ent = -np.sum(nat_occa * np.log(nat_occa)) - np.sum(nat_occb * np.log(nat_occb))
        entr = -2 * np.sum(nat_occr / 2 * np.log(nat_occr / 2))

        return caoas, entr - ent, asorbs


def get_dmet_imp_ldm(mf, imp_inds, lo_meth="lowdin"):
    """
    Returns better initial guess than '1e' for impurity
    """
    s = mf.get_ovlp()
    caolo_mat, cloao_mat = caolo(s), cloao(s)

    dma, dmb = mf.make_rdm1()

    ldm = reduce(np.dot, (cloao_mat, (dma + dmb), cloao_mat.conj().T))[imp_inds, :][
        :, imp_inds
    ]
    return ldm


def get_as_1e_ints(mf, caoas, asorbs):
    # hcore from mf
    hcore = mf.get_hcore()

    # HF J/K from env UO
    uos = hcore.shape[0] - asorbs[-1]
    dm_uo = caoas[:, uos:] @ caoas[:, uos:].conj().T * 2
    vj, vk = mf.get_jk(dm=dm_uo)

    fock = hcore + vj - 0.5 * vk

    nimp = hcore.shape[0] - np.sum(asorbs)
    act_inds = [
        *list(range(nimp)),
        *list(range(nimp + asorbs[0], nimp + asorbs[0] + asorbs[1])),
    ]

    asints1e = reduce(np.dot, (caoas[:, act_inds].conj().T, fock, caoas[:, act_inds]))
    return asints1e


def get_as_2e_ints(mf, caoas, asorbs):
    nimp = caoas.shape[0] - np.sum(asorbs)
    act_inds = [
        *list(range(nimp)),
        *list(range(nimp + asorbs[0], nimp + asorbs[0] + asorbs[1])),
    ]

    if mf._eri is not None:
        asints2e = ao2mo.full(mf._eri, caoas[:, act_inds])
    else:
        asints2e = ao2mo.full(mf.mol, caoas[:, act_inds])

    return asints2e


def get_bp_hso2e(mol, dm0):
    hso2e = mol.intor("int2e_p1vxp1", 3).reshape(3, mol.nao, mol.nao, mol.nao, mol.nao)
    vj = np.einsum("yijkl,lk->yij", hso2e, dm0, optimize=True)
    vk = np.einsum("yijkl,jk->yil", hso2e, dm0, optimize=True)
    vk += np.einsum("yijkl,li->ykj", hso2e, dm0, optimize=True)
    return vj, vk


def get_bp_hso2e_amfi(mol, dm0):
    """atomic-mean-field approximation"""
    ao_loc = mol.ao_loc_nr()
    nao = ao_loc[-1]
    vj = np.zeros((3, nao, nao))
    vk = np.zeros((3, nao, nao))
    import copy

    atom = copy.copy(mol)
    aoslice = mol.aoslice_by_atom(ao_loc)
    for ia in range(mol.natm):
        b0, b1, p0, p1 = aoslice[ia]
        atom._bas = mol._bas[b0:b1]
        vj1, vk1 = get_bp_hso2e(atom, dm0[p0:p1, p0:p1])
        vj[:, p0:p1, p0:p1] = vj1
        vk[:, p0:p1, p0:p1] = vk1
    return vj, vk

if __name__ == "__main__":
    mol = gto.M(
        atom="""
Co       0.08614000      12.11827000       3.79913000 
N       -1.03087000      12.08263000       1.98298000 
N       -1.95892000      12.14777000       4.39138000 
N       -2.70024000      12.08608000       5.50995000 
H       -2.37428000      12.16884000       6.32356000 
N        1.18073000      10.64850000       2.70623000 
N        0.50813000      10.51364000       5.18129000 
N        0.27159000      10.17225000       6.45848000 
H       -0.20185000      10.65923000       7.01687000 
N        1.38678000      13.37998000       2.68823000 
N        0.85251000      13.55623000       5.21213000 
N        0.85714000      13.78190000       6.54474000 
H        0.31753000      13.38534000       7.11490000 
O       -0.46275000      12.07689000       0.71844000 
O        1.52561000      10.77360000       1.37361000 
O        1.64253000      13.22940000       1.35543000 
B        1.03912000      12.02516000       0.72183000 
C       -3.19233000      11.76462000       0.83411000 
H       -3.05941000      12.50218000       0.20318000 
H       -4.12766000      11.74738000       1.12641000 
H       -2.97296000      10.91594000       0.39567000 
C       -2.30918000      11.95428000       2.01220000 
C       -2.82609000      11.96769000       3.37566000 
C       -4.12290000      11.80485000       3.86935000 
H       -4.91909000      11.66883000       3.36853000 
C       -4.00314000      11.88148000       5.23637000 
H       -4.70720000      11.80485000       5.86908000 
C        2.45210000       8.55574000       2.59323000
H        3.26754000       8.96763000       2.23856000 
H        1.93667000       8.16493000       1.85715000 
H        2.69438000       7.85266000       3.23129000 
C        1.63440000       9.58641000       3.27763000 
C        1.24980000       9.50787000       4.68742000 
C        1.48880000       8.53658000       5.65699000 
H        1.98618000       7.73197000       5.56252000 
C        0.84263000       8.99828000       6.78696000 
H        0.80778000       8.56915000       7.63354000 
C        3.17695000      15.04822000       2.63066000 
H        2.79814000      15.55397000       1.88388000 
H        3.86951000      14.44092000       2.29737000 
H        3.57097000      15.66700000       3.27941000 
C        2.10425000      14.26084000       3.28832000 
C        1.82096000      14.34897000       4.72485000 
C        2.43325000      15.06737000       5.75145000 
H        3.14855000      15.68808000       5.67481000 
C        1.78385000      14.68422000       6.88855000 
H        1.95883000      15.00032000       7.76722000 
C        1.53838000      11.95811000      -0.79668000 
C        1.26255000      10.84123000      -1.58802000 
H        0.75942000      10.12665000      -1.21730000 
C        1.70236000      10.74544000      -2.90157000 
H        1.48992000       9.97914000      -3.42200000 
C        2.45632000      11.77803000      -3.45051000 
H        2.78318000      11.70906000      -4.33987000 
C        2.72753000      12.89874000      -2.70195000 
H        3.22141000      13.61332000      -3.08693000 
C        2.28708000      12.99262000      -1.39019000 
H        2.49441000      13.77041000      -0.88402000
            """,
    basis={"default": "def2tzvp", "C": "6-31G*", "H": "6-31G*", "O": "6-31G*", "B": "6-31G*"},
    symmetry=0,
    spin=3,
    charge=+1,
    verbose=4,
    max_memory=200000,
    )
    
    mf = scf.rohf.ROHF(mol).x2c()
    mf.max_cycle = 100
    title = "CoN6BO3"
    imp_inds = mol.search_ao_label(["Co *"])
    mf.chkfile = title + "_rohf.chk"
    mf.init_guess = "atom"
    mf.level_shift = 0.2
    if os.path.isfile(title + "_rohf.chk"):
        mf.init_guess = "chk"
        mf.level_shift = 0.0
    mf = tag_rdiis_(mf=mf, imp_inds=imp_inds)
    mf.kernel()

    print("nao = ", mol.nao_nr())
    print("nelec = ", mol.nelec)


    print("imp_inds.shape", imp_inds.shape)

    # AS general info
    caoas, ent, asorbs = get_dmet_as_props(mf, imp_inds, thres=1e-13)
    # AS hcore + j/k
    as1e = get_as_1e_ints(mf, caoas, asorbs)
    # AS ERIs
    as2e = get_as_2e_ints(mf, caoas, asorbs)

    print(f"Entanglement S: {ent:.3f}")

    nimp = caoas.shape[0] - np.sum(asorbs)
    print("nimp = ", nimp)
    act_inds = [
        *list(range(nimp)),
        *list(range(nimp + asorbs[0], nimp + asorbs[0] + asorbs[1])),
    ]

    print("act_inds = ", act_inds)

    nelec = int(mf.mol.nelectron - asorbs[-1] * 2)
    ldm = get_dmet_imp_ldm(mf, imp_inds)
    solver_base = rohf_solve_imp(as1e, as2e, nelec, mf.mol.spin, mf.max_memory, dm0=ldm)

    with open(title + "_imp_rohf_orbs.molden", "w") as f1:
        molden.header(mf.mol, f1)
        molden.orbital_coeff(
            mf.mol,
            f1,
            caoas[:, act_inds] @ solver_base.mo_coeff,
            ene=solver_base.mo_energy,
            occ=solver_base.mo_occ,
        )

    casinfo_fname = title + "_cas_info"


    if not os.path.isfile(casinfo_fname):
        print("Failed to read saved CAS briefings.")
        exit()


    ncasorb, ncaselec, casorbind, statelis = read_cas_info(casinfo_fname)

    solver = sacasscf_solve_imp(
        solver_base, mf.mol, ncasorb, ncaselec, casorbind, statelis=statelis
    )

    mc = solver.copy()
    fcidump.from_integrals(
        "FCIDUMP",
        solver.get_h1eff()[0],
        solver.get_h2eff(),
        solver.ncas,
        solver.nelecas,
        nuc=solver.get_h1eff()[1],
    )

    uos = caoas.shape[0] - asorbs[-1]
    dm_uo = caoas[:, uos:] @ caoas[:, uos:].conj().T * 2
    mo_cas = caoas[:, act_inds] @ mc.mo_coeff[:, mc.ncore : mc.ncore + mc.ncas]
    print("mo_cas.shape = ", mo_cas.shape)
    sodm1_act = reduce(
        np.dot, [caoas[:, act_inds], mc.make_rdm1(), caoas[:, act_inds].conj().T]
    )
    sodm1 = sodm1_act + dm_uo

    # soc integral
    # breit-pauli amfi
    # amfi = True
    # hso1e = mol.intor_asymmetric("int1e_pnucxp", 3)
    # vj, vk = get_bp_hso2e_amfi(mol, sodm1) if amfi else get_bp_hso2e(mol, sodm1)
    # hso2e = vj - vk * 1.5
    # hsoao = 1.0j * (nist.ALPHA**2 / 2) * (hso1e + hso2e)
    # print("hsoao.shape = ", hsoao.shape)

    # hso = np.asarray([reduce(np.dot, (mo_cas.T, x.T, mo_cas)) for x in hsoao])
    # print("hso.shape = ", hso.shape)
    # # Save each component of hso (shape: 3 x nao x nao) to separate binary files as complex128
    # hso[0].astype(np.complex128).tofile("hso_x.bin")
    # hso[1].astype(np.complex128).tofile("hso_y.bin")
    # hso[2].astype(np.complex128).tofile("hso_z.bin")

    # x2camf
    from mycamf import x2camf
    import os

    xmol, ctr = mf.with_x2c.get_xmol(mol)
    xdmao = ctr @ sodm1 @ ctr.conj().T
    print("sodm1.shape = ", sodm1.shape)
    print("xdmao.shape = ", xdmao.shape)
    x = mf.with_x2c.get_xmat()
    r = mf.with_x2c._get_rmat(x=x)
    hso1e = xmol.intor_asymmetric("int1e_pnucxp", 3)
    hso1e = np.einsum(
        "pq,qr,irs,sk,kl->ipl", r.conj().T, x.conj().T, hso1e, x, r, optimize=True
    )

    hso2e = x2camf.amfi(mf.with_x2c, printLevel=1)

    hso2e = hso2e / (nist.ALPHA**2 / 4)
    sphsp = xmol.sph2spinor_coeff()
    p_repr = np.einsum("ixp,pq,jyq->ijxy", sphsp, hso2e, sphsp.conj(), optimize=True)
    hso2e = (p_repr[0, np.array([1, 1, 0])] * np.array([-1j, 1, -1j])[:, None, None]).real

    s22 = xmol.intor_symmetric("int1e_ovlp")
    s21 = gto.intor_cross("int1e_ovlp", xmol, mol)
    c = cho_solve(s22, s21)
    hso1e = c.conj().T @ hso1e @ c
    hso2e = c.conj().T @ hso2e @ c
    print("hso1e.shape = ", hso1e.shape)
    print("hso2e.shape = ", hso2e.shape)
    hsoao = (1j * nist.ALPHA**2 / 2) * (hso1e + hso2e)

    hso = np.asarray([reduce(np.dot, (mo_cas.T.conj(), i.T, mo_cas)) for i in hsoao])
    print("hso.shape = ", hso.shape)
    # Save each component of hso (shape: 3 x nao x nao) to separate binary files as complex128
    hso_labels = ["x", "y", "z"]
    for i, label in enumerate(hso_labels):
        with open(f"hso_{label}.bin", "wb") as f:
            # 先写入shape信息（int32），再写入数据（complex128）
            shape = np.array(hso[i].shape, dtype=np.int32)
            f.write(shape.tobytes())
            f.write(hso[i].astype(np.complex128).tobytes())
            # print(hso[i])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cu01', release='5.15.0-139-generic', version='#149-Ubuntu SMP Fri Apr 11 22:06:13 UTC 2025', machine='x86_64')  Threads 32
Python 3.11.13 (main, Jun  5 2025, 13:12:00) [GCC 11.2.0]
numpy 2.3.1  scipy 1.16.0  h5py 3.14.0
Date: Tue Jul  8 10:39:45 2025
PySCF version 2.9.0
PySCF path  /home/Yxwxwx/.conda/envs/pyscf_311/lib/python3.11/site-packages/pyscf

[CONFIG] conf_file None
[INPUT] verbose = 4
[INPUT] num. atoms = 58
[INPUT] num. electrons = 267
[INPUT] charge = 1
[INPUT] spin (= nelec alpha-beta = 2S) = 3
[INPUT] symmetry 0 subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Co     0.086140000000  12.118270000000   3.799130000000 AA    0.162781008370  22.900211403533   7.179315211619 Bohr   0.0
[INPUT]  2 N     -1.030870000000  12.082630000000   1.982980000000 AA   -1.948061970030  22.832861564454   3.747289110490 Bohr   0.0
[INPUT]  3 N     -1.958920000000  12.147770000000   4.391380000000 AA   -3.701822299933  22.955958324208   8.298505508893 Bohr   0.0
[INPUT]  4 N     -2.700240000000  12.086080000000   5.509950000000 AA   -5.102714070596  22.839381119583  10.412296460047 Bohr   0.0
[INPUT]  5 H     -2.374280000000  12.168840000000   6.323560000000 AA   -4.486738943032  22.995774853652  11.949796532255 Bohr   0.0
[INPUT]  6 N      1.180730000000  10.648500000000   2.706230000000 AA    2.231256327058  20.122748637431   5.114033530082 Bohr   0.0
[INPUT]  7 N      0.508130000000  10.513640000000   5.181290000000 AA    0.960226535675  19.867900172272   9.791219071948 Bohr   0.0
[INPUT]  8 N      0.271590000000  10.172250000000   6.458480000000 AA    0.513230718171  19.222766570607  12.204758380981 Bohr   0.0
[INPUT]  9 H     -0.201850000000  10.659230000000   7.016870000000 AA   -0.381441218243  20.143025398748  13.259962551677 Bohr   0.0
[INPUT] 10 N      1.386780000000  13.379980000000   2.688230000000 AA    2.620634395024  25.284497752158   5.080018459840 Bohr   0.0
[INPUT] 11 N      0.852510000000  13.556230000000   5.212130000000 AA    1.611010418453  25.617561981613   9.849498225629 Bohr   0.0
[INPUT] 12 N      0.857140000000  13.781900000000   6.544740000000 AA    1.619759850410  26.044016476143  12.367766156486 Bohr   0.0
[INPUT] 13 H      0.317530000000  13.385340000000   7.114900000000 AA    0.600044736333  25.294626684186  13.445212403668 Bohr   0.0
[INPUT] 14 O     -0.462750000000  12.076890000000   0.718440000000 AA   -0.874470764142  22.822014536499   1.357654836933 Bohr   0.0
[INPUT] 15 O      1.525610000000  10.773600000000   1.373610000000 AA    2.882985072898  20.359153375614   2.595746701964 Bohr   0.0
[INPUT] 16 O      1.642530000000  13.229400000000   1.355430000000 AA    3.103931851382  24.999942792321   2.561391481019 Bohr   0.0
[INPUT] 17 B      1.039120000000  12.025160000000   0.721830000000 AA    1.963652210558  22.724259004075   1.364061008495 Bohr   0.0
[INPUT] 18 C     -3.192330000000  11.764620000000   0.834110000000 AA   -6.032629399233  22.231909759581   1.576239457761 Bohr   0.0
[INPUT] 19 H     -3.059410000000  12.502180000000   0.203180000000 AA   -5.781447002756  23.625696160015   0.383954553989 Bohr   0.0
[INPUT] 20 H     -4.127660000000  11.747380000000   1.126410000000 AA   -7.800146935322  22.199330881193   2.128606403971 Bohr   0.0
[INPUT] 21 H     -2.972960000000  10.915940000000   0.395670000000 AA   -5.618080179287  20.628136992185   0.747707935707 Bohr   0.0
[INPUT] 22 C     -2.309180000000  11.954280000000   2.012200000000 AA   -4.363717772323  22.590315216366   3.802506907850 Bohr   0.0
[INPUT] 23 C     -2.826090000000  11.967690000000   3.375660000000 AA   -5.340536103372  22.615656443696   6.379072889649 Bohr   0.0
[INPUT] 24 C     -4.122900000000  11.804850000000   3.869350000000 AA   -7.791151838969  22.307933441572   7.312011780086 Bohr   0.0
[INPUT] 25 H     -4.919090000000  11.668830000000   3.368530000000 AA   -9.295732882087  22.050892894109   6.365599142381 Bohr   0.0
[INPUT] 26 C     -4.003140000000  11.881480000000   5.236370000000 AA   -7.564838238291  22.452743154497   9.895305186889 Bohr   0.0
[INPUT] 27 H     -4.707200000000  11.804850000000   5.869080000000 AA   -8.895318813553  22.307933441572  11.090953803162 Bohr   0.0
[INPUT] 28 C      2.452100000000   8.555740000000   2.593230000000 AA    4.633797430046  16.168005392986   4.900494478006 Bohr   0.0
[INPUT] 29 H      3.267540000000   8.967630000000   2.238560000000 AA    6.174755701061  16.946364686433   4.230265313406 Bohr   0.0
[INPUT] 30 H      1.936670000000   8.164930000000   1.857150000000 AA    3.659775893661  15.429481526245   3.509504872236 Bohr   0.0
[INPUT] 31 H      2.694380000000   7.852660000000   3.231290000000 AA    5.091640275506  14.839376749327   6.106253129046 Bohr   0.0
[INPUT] 32 C      1.634400000000   9.586410000000   3.277630000000 AA    3.088568377989  18.115689417792   6.193823037658 Bohr   0.0
[INPUT] 33 C      1.249800000000   9.507870000000   4.687420000000 AA    2.361779710481  17.967270327968   8.857940030809 Bohr   0.0
[INPUT] 34 C      1.488800000000   8.536580000000   5.656990000000 AA    2.813424254252  16.131798240440  10.690161789403 Bohr   0.0
[INPUT] 35 H      1.986180000000   7.731970000000   5.562520000000 AA    3.753336234089  14.611305703353  10.511639362416 Bohr   0.0
[INPUT] 36 C      0.842630000000   8.998280000000   6.786960000000 AA    1.592339924342  17.004284792151  12.825495618378 Bohr   0.0
[INPUT] 37 H      0.807780000000   8.569150000000   7.633540000000 AA    1.526482968901  16.193346620317  14.425299960912 Bohr   0.0
[INPUT] 38 C      3.176950000000  15.048220000000   2.630660000000 AA    6.003565411437  28.437014462202   4.971226926848 Bohr   0.0
[INPUT] 39 H      2.798140000000  15.553970000000   1.883880000000 AA    5.287718258190  29.392743449701   3.560017251546 Bohr   0.0
[INPUT] 40 H      3.869510000000  14.440920000000   2.297370000000 AA    7.312314136266  27.289383786754   4.341400106792 Bohr   0.0
[INPUT] 41 H      3.570970000000  15.667000000000   3.279410000000 AA    6.748155299038  29.606339193561   6.197186750160 Bohr   0.0
[INPUT] 42 C      2.104250000000  14.260840000000   3.288320000000 AA    3.976456197616  26.949081906242   6.214024209930 Bohr   0.0
[INPUT] 43 C      1.820960000000  14.348970000000   4.724850000000 AA    3.441115683788  27.115623469600   8.928672479651 Bohr   0.0
[INPUT] 44 C      2.433250000000  15.067370000000   5.751450000000 AA    4.598176092598  28.473202717488  10.868665319130 Bohr   0.0
[INPUT] 45 H      3.148550000000  15.688080000000   5.674810000000 AA    5.949897189499  29.646174620267  10.723836708943 Bohr   0.0
[INPUT] 46 C      1.783850000000  14.684220000000   6.888550000000 AA    3.370987947305  27.749154152861  13.017472895373 Bohr   0.0
[INPUT] 47 H      1.958830000000  15.000320000000   7.767220000000 AA    3.701652224582  28.346496580836  14.677918549244 Bohr   0.0
[INPUT] 48 C      1.538380000000  11.958110000000  -0.796680000000 AA    2.907116875508  22.597552867423  -1.505507008918 Bohr   0.0
[INPUT] 49 C      1.262550000000  10.841230000000  -1.588020000000 AA    2.385873718570  20.486955553418  -3.000922880332 Bohr   0.0
[INPUT] 50 H      0.759420000000  10.126650000000  -1.217300000000 AA    1.435095813517  19.136595059327  -2.300363611433 Bohr   0.0
[INPUT] 51 C      1.702360000000  10.745440000000  -2.901570000000 AA    3.216994165415  20.305938687946  -5.483172631254 Bohr   0.0
[INPUT] 52 H      1.489920000000   9.979140000000  -3.422000000000 AA    2.815540747512  18.857841558692  -6.466642798262 Bohr   0.0
[INPUT] 53 C      2.456320000000  11.778030000000  -3.450510000000 AA    4.641772074292  22.257250986911  -6.520518890073 Bohr   0.0
[INPUT] 54 H      2.783180000000  11.709060000000  -4.339870000000 AA    5.259447955367  22.126916576100  -8.201165716216 Bohr   0.0
[INPUT] 55 C      2.727530000000  12.898740000000  -2.701950000000 AA    5.154284696535  24.375085951972  -5.105945502269 Bohr   0.0
[INPUT] 56 H      3.221410000000  13.613320000000  -3.086930000000 AA    6.087582634935  25.725446446064  -5.833452265704 Bohr   0.0
[INPUT] 57 C      2.287080000000  12.992620000000  -1.390190000000 AA    4.321954824970  24.552493440547  -2.627078361109 Bohr   0.0
[INPUT] 58 H      2.494410000000  13.770410000000  -0.884020000000 AA    4.713751742376  26.022303522972  -1.670555688638 Bohr   0.0

nuclear repulsion = 4623.64001576696
number of shells = 310
number of NR pGTOs = 1273
number of NR cGTOs = 720
basis = {'default': 'def2tzvp', 'C': '6-31G*', 'H': '6-31G*', 'O': '6-31G*', 'B': '6-31G*'}
ecp = {}
CPU time:         6.45


******** <class 'pyscf.x2c.sfx2c1e.sfX2C1eROHF'> ********
method = sfX2C1eROHF
initial guess = chk
damping factor = 0
level_shift factor = 0.0
DIIS = <class 'liblan.utils.rdiis.tag_rdiis_.<locals>.RDIIS'>
diis_start_cycle = 1
diis_space = 8
diis_damp = 0
SCF conv_tol = 1e-09
SCF conv_tol_grad = None
SCF max_cycles = 100
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = CoN6BO3_rohf.chk
max_memory 200000 MB (current use 141 MB)
num. doubly occ = 132  num. singly occ = 3


******** <class 'pyscf.x2c.sfx2c1e.SpinFreeX2CHelper'> ********
approx = 1e
xuncontract = 1
Set gradient conv threshold to 3.16228e-05
init E= -2938.32198445032
  HOMO = -0.212025291616195  LUMO = -0.030888847983389
cycle= 1 E= -2938.32198444904  delta_E= 1.28e-09  |g|= 3.51e-05  |ddm|= 5.61e-05
----------SDDIS-Entropy 0.022
  HOMO = -0.21202738138089  LUMO = -0.0308889799080253
cycle= 2 E= -2938.32198442948  delta_E= 1.96e-08  |g|= 0.000129  |ddm|= 0.000201
----------SDDIS-Entropy 0.022
  HOMO = -0.212026431583071  LUMO = -0.0308889159983079
cycle= 3 E= -2938.32198445046  delta_E= -2.1e-08  |g|= 1.31e-05  |ddm|= 0.000164
----------SDDIS-Entropy 0.022
  HOMO = -0.212026030254809  LUMO = -0.0308888952046517
cycle= 4 E= -2938.32198445066  delta_E= -1.99e-10  |g|= 5.29e-06  |ddm|= 1.66e-05
  HOMO = -0.212025736276824  LUMO = -0.0308888815229801
Extra cycle  E= -2938.32198445064  delta_E= 2.09e-11  |g|= 1.05e-05  |ddm|= 1.7e-05
converged SCF energy = -2938.32198445064
nao =  720
nelec =  (135, 132)
imp_inds.shape (45,)
caoas.shape =  (720, 720)
asorbs =  (np.int64(540), np.int64(52), np.int64(83))
Entanglement S: 0.022
nimp =  45
act_inds =  [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 585, 586, 587, 588, 589, 590, 591, 592, 593, 594, 595, 596, 597, 598, 599, 600, 601, 602, 603, 604, 605, 606, 607, 608, 609, 610, 611, 612, 613, 614, 615, 616, 617, 618, 619, 620, 621, 622, 623, 624, 625, 626, 627, 628, 629, 630, 631, 632, 633, 634, 635, 636]
nao =  97
nelec =  (52, 49)


******** <class 'pyscf.x2c.sfx2c1e.sfX2C1eROHF'> ********
method = sfX2C1eROHF
initial guess = 1e
damping factor = 0
level_shift factor = 0.2
DIIS = <class 'pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 8
diis_damp = 0
SCF conv_tol = 1e-09
SCF conv_tol_grad = None
SCF max_cycles = 1000
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = /home/Yxwxwx/code/dmet/test/large_44/tmp_64631/tmpu2p79gfy
max_memory 200000 MB (current use 798 MB)
num. doubly occ = 49  num. singly occ = 3


******** <class 'pyscf.x2c.sfx2c1e.SpinFreeX2CHelper'> ********
approx = 1e
xuncontract = 1
Set gradient conv threshold to 3.16228e-05
init E= -2277.97851593596
  HOMO = 1.07516204937432  LUMO = 1.12857868062035
cycle= 1 E= -2347.71576226731  delta_E= -69.7  |g|= 4.03  |ddm|= 10.1

WARN: HOMO -0.483808549610191 >= LUMO -0.622726752817725

cycle= 2 E= -2339.83894770475  delta_E= 7.88  |g|= 9.98  |ddm|= 4.13
  HOMO = -0.35856818592359  LUMO = -0.0175385668688388
cycle= 3 E= -2347.99596864049  delta_E= -8.16  |g|= 5.73  |ddm|=  1.7
  HOMO = -0.392243287660749  LUMO = 0.311731230897691
cycle= 4 E= -2350.9045747628  delta_E= -2.91  |g|= 3.33  |ddm|= 1.15

WARN: HOMO 0.343207873467788 >= LUMO -0.137268028279449

cycle= 5 E= -2352.67329601511  delta_E= -1.77  |g|= 0.496  |ddm|= 1.86
  HOMO = 0.202398190110705  LUMO = 0.266277237764179
cycle= 6 E= -2352.85669924564  delta_E= -0.183  |g|= 0.179  |ddm|= 0.699
  HOMO = 0.211807634245678  LUMO = 0.283123685609759
cycle= 7 E= -2352.88265843408  delta_E= -0.026  |g|= 0.104  |ddm|= 0.292
  HOMO = 0.195635992636907  LUMO = 0.300396793000733
cycle= 8 E= -2352.92332239552  delta_E= -0.0407  |g|= 0.142  |ddm|= 0.462
  HOMO = 0.170630949554499  LUMO = 0.322847744314066
cycle= 9 E= -2352.97881385474  delta_E= -0.0555  |g|= 0.354  |ddm|= 0.417
  HOMO = 0.155159093424999  LUMO = 0.335208750447688
cycle= 10 E= -2353.01465468813  delta_E= -0.0358  |g|= 0.499  |ddm|= 0.25

WARN: HOMO 0.287170609579235 >= LUMO 0.198235635542024

cycle= 11 E= -2353.05707299699  delta_E= -0.0424  |g|= 0.889  |ddm|= 0.972

WARN: HOMO 0.293979541556922 >= LUMO 0.196333540112157

cycle= 12 E= -2352.98044849286  delta_E= 0.0766  |g|= 0.554  |ddm|= 0.774
  HOMO = 0.196510132841801  LUMO = 0.301824509527208
cycle= 13 E= -2353.03957999147  delta_E= -0.0591  |g|= 0.775  |ddm|= 0.502
  HOMO = 0.174718606487384  LUMO = 0.324627325074568
cycle= 14 E= -2353.0631647386  delta_E= -0.0236  |g|= 0.837  |ddm|= 0.394
  HOMO = 0.0811769958093945  LUMO = 0.422001413531657
cycle= 15 E= -2353.06055192111  delta_E= 0.00261  |g|= 0.718  |ddm|= 0.448
  HOMO = -0.00259325602797348  LUMO = 0.479116669424546
cycle= 16 E= -2353.05417747953  delta_E= 0.00637  |g|= 0.647  |ddm|= 0.133
  HOMO = -0.0183183477003264  LUMO = 0.482178616594439
cycle= 17 E= -2353.06388593696  delta_E= -0.00971  |g|= 0.67  |ddm|= 0.091
  HOMO = -0.0701893064661909  LUMO = 0.487143066929502
cycle= 18 E= -2353.08746847655  delta_E= -0.0236  |g|= 0.728  |ddm|= 0.337
  HOMO = -0.021963534559976  LUMO = 0.47497004069286
cycle= 19 E= -2353.0839815522  delta_E= 0.00349  |g|= 0.702  |ddm|= 0.432
  HOMO = -0.115498803929898  LUMO = 0.484225880051282
cycle= 20 E= -2353.09672719783  delta_E= -0.0127  |g|= 0.712  |ddm|= 0.13
  HOMO = -0.126261251339294  LUMO = 0.493310735567177
cycle= 21 E= -2353.10220971809  delta_E= -0.00548  |g|= 0.685  |ddm|= 0.339
  HOMO = -0.114708872464308  LUMO = 0.499954024409205
cycle= 22 E= -2353.10078826878  delta_E= 0.00142  |g|= 0.521  |ddm|= 0.376
  HOMO = -0.126533090449429  LUMO = 0.496130860833192
cycle= 23 E= -2353.07633793808  delta_E= 0.0245  |g|= 0.536  |ddm|= 0.0833
  HOMO = -0.0573946142754008  LUMO = 0.514334174835796
cycle= 24 E= -2353.21531836498  delta_E= -0.139  |g|= 0.314  |ddm|= 0.389
  HOMO = -0.0584342126266321  LUMO = 0.51150974042202
cycle= 25 E= -2353.28754007153  delta_E= -0.0722  |g|= 0.295  |ddm|= 0.232
  HOMO = -0.0877100360883315  LUMO = 0.504002151359826
cycle= 26 E= -2353.33918763847  delta_E= -0.0516  |g|= 0.305  |ddm|= 0.194
  HOMO = -0.0748934853911465  LUMO = 0.505823191289428
cycle= 27 E= -2353.40557158951  delta_E= -0.0664  |g|= 0.304  |ddm|= 0.237
  HOMO = -0.0897511535483713  LUMO = 0.504037250899497
cycle= 28 E= -2353.32847318953  delta_E= 0.0771  |g|= 0.317  |ddm|= 0.303
  HOMO = -0.0926093889163438  LUMO = 0.37535504691281
cycle= 29 E= -2353.45363987175  delta_E= -0.125  |g|= 0.287  |ddm|=  1.2
  HOMO = -0.0163771580038768  LUMO = 0.366562548749366
cycle= 30 E= -2353.52729639455  delta_E= -0.0737  |g|= 0.0938  |ddm|= 0.502
  HOMO = -0.0966336685919445  LUMO = 0.389795819013251
cycle= 31 E= -2353.5321412749  delta_E= -0.00484  |g|= 0.0798  |ddm|= 0.183
  HOMO = -0.0941084947411943  LUMO = 0.378910075138491
cycle= 32 E= -2353.53142278509  delta_E= 0.000718  |g|= 0.0824  |ddm|= 0.0298
  HOMO = -0.0972259909853007  LUMO = 0.373050462118709
cycle= 33 E= -2353.53269716708  delta_E= -0.00127  |g|= 0.0708  |ddm|= 0.0258
  HOMO = -0.10629560317917  LUMO = 0.372743502249917
cycle= 34 E= -2353.53452084551  delta_E= -0.00182  |g|= 0.0374  |ddm|= 0.045
  HOMO = -0.111083492064563  LUMO = 0.373132360522575
cycle= 35 E= -2353.53492151469  delta_E= -0.000401  |g|= 0.0153  |ddm|= 0.0183
  HOMO = -0.112990226339029  LUMO = 0.372036967800217
cycle= 36 E= -2353.53512730529  delta_E= -0.000206  |g|= 0.0031  |ddm|= 0.0238
  HOMO = -0.112504950526752  LUMO = 0.372234037005801
cycle= 37 E= -2353.53514801242  delta_E= -2.07e-05  |g|= 0.00243  |ddm|= 0.00661
  HOMO = -0.112220867486318  LUMO = 0.372270710824009
cycle= 38 E= -2353.53516733353  delta_E= -1.93e-05  |g|= 0.0021  |ddm|= 0.00693
  HOMO = -0.112040869720944  LUMO = 0.372254455997077
cycle= 39 E= -2353.53519955386  delta_E= -3.22e-05  |g|= 0.00154  |ddm|= 0.0141
  HOMO = -0.112006265794635  LUMO = 0.372245137056067
cycle= 40 E= -2353.53522124979  delta_E= -2.17e-05  |g|= 0.00114  |ddm|= 0.0126
  HOMO = -0.112023707720066  LUMO = 0.372244875554412
cycle= 41 E= -2353.53523524674  delta_E= -1.4e-05  |g|= 0.000894  |ddm|= 0.0109
  HOMO = -0.112015495573485  LUMO = 0.372246017187555
cycle= 42 E= -2353.53524541972  delta_E= -1.02e-05  |g|= 0.000696  |ddm|= 0.0107
  HOMO = -0.112058317936051  LUMO = 0.372244594157391
cycle= 43 E= -2353.53525198908  delta_E= -6.57e-06  |g|= 0.000504  |ddm|= 0.00971
  HOMO = -0.112004877271427  LUMO = 0.372246143507367
cycle= 44 E= -2353.53525472556  delta_E= -2.74e-06  |g|= 0.000286  |ddm|= 0.00603
  HOMO = -0.111997232348118  LUMO = 0.372245151324947
cycle= 45 E= -2353.53525599855  delta_E= -1.27e-06  |g|= 0.000208  |ddm|= 0.00503
  HOMO = -0.112010169643031  LUMO = 0.372245260295323
cycle= 46 E= -2353.53525634656  delta_E= -3.48e-07  |g|= 0.000133  |ddm|= 0.00239
  HOMO = -0.111999519486704  LUMO = 0.372245544057635
cycle= 47 E= -2353.53525647964  delta_E= -1.33e-07  |g|= 0.000108  |ddm|= 0.00145
  HOMO = -0.112013655307584  LUMO = 0.372245758179429
cycle= 48 E= -2353.53525654308  delta_E= -6.34e-08  |g|= 9.7e-05  |ddm|= 0.000644
  HOMO = -0.112015282807558  LUMO = 0.372245855988991
cycle= 49 E= -2353.53525658854  delta_E= -4.55e-08  |g|= 9.46e-05  |ddm|= 0.000391
  HOMO = -0.112018087187979  LUMO = 0.372245931867134
cycle= 50 E= -2353.53525663408  delta_E= -4.55e-08  |g|= 9.29e-05  |ddm|= 0.000381
  HOMO = -0.112022245208371  LUMO = 0.372246066828973
cycle= 51 E= -2353.53525674671  delta_E= -1.13e-07  |g|= 8.58e-05  |ddm|= 0.000966
  HOMO = -0.112028055954272  LUMO = 0.372246109090801
cycle= 52 E= -2353.53525685575  delta_E= -1.09e-07  |g|= 8.38e-05  |ddm|= 0.000952
  HOMO = -0.112028119273292  LUMO = 0.372246143674264
cycle= 53 E= -2353.53525693322  delta_E= -7.75e-08  |g|= 8.42e-05  |ddm|= 0.000696
  HOMO = -0.112031428289395  LUMO = 0.37224611229528
cycle= 54 E= -2353.53525702416  delta_E= -9.09e-08  |g|= 8.24e-05  |ddm|= 0.000816
  HOMO = -0.112032574975552  LUMO = 0.372245773150122
cycle= 55 E= -2353.53525727554  delta_E= -2.51e-07  |g|= 8.62e-05  |ddm|= 0.00229
  HOMO = -0.1120328893872  LUMO = 0.372245647035881
cycle= 56 E= -2353.53525734242  delta_E= -6.69e-08  |g|= 7.92e-05  |ddm|= 0.000623
  HOMO = -0.11203467849241  LUMO = 0.372245259458744
cycle= 57 E= -2353.53525768957  delta_E= -3.47e-07  |g|= 0.00011  |ddm|= 0.0034
  HOMO = -0.112035219058837  LUMO = 0.372244539335362
cycle= 58 E= -2353.53525809663  delta_E= -4.07e-07  |g|= 0.000139  |ddm|= 0.0043
  HOMO = -0.112032457022177  LUMO = 0.372244259566387
cycle= 59 E= -2353.53525829902  delta_E= -2.02e-07  |g|= 8.37e-05  |ddm|= 0.00222
  HOMO = -0.112031461793791  LUMO = 0.372242970097149
cycle= 60 E= -2353.53525886098  delta_E= -5.62e-07  |g|= 0.000236  |ddm|= 0.00718
  HOMO = -0.112030843640397  LUMO = 0.372242101102914
cycle= 61 E= -2353.53525932786  delta_E= -4.67e-07  |g|= 0.000239  |ddm|= 0.00693
  HOMO = -0.112026144619084  LUMO = 0.372241217328481
cycle= 62 E= -2353.53525964214  delta_E= -3.14e-07  |g|= 0.000189  |ddm|= 0.00544
  HOMO = -0.112021535969451  LUMO = 0.372240634525146
cycle= 63 E= -2353.53525986746  delta_E= -2.25e-07  |g|= 0.00016  |ddm|= 0.00466
  HOMO = -0.112021422490755  LUMO = 0.372239695339639
cycle= 64 E= -2353.53526009881  delta_E= -2.31e-07  |g|= 0.000231  |ddm|= 0.00655
  HOMO = -0.11201979430237  LUMO = 0.372239813336866
cycle= 65 E= -2353.53526014009  delta_E= -4.13e-08  |g|= 4e-05  |ddm|= 0.000783
  HOMO = -0.112016051547453  LUMO = 0.372239386475453
cycle= 66 E= -2353.53526022639  delta_E= -8.63e-08  |g|= 0.000116  |ddm|= 0.00347
  HOMO = -0.112018722104234  LUMO = 0.372238643376523
cycle= 67 E= -2353.5352603111  delta_E= -8.47e-08  |g|= 0.000201  |ddm|= 0.00552
  HOMO = -0.112020402961995  LUMO = 0.372239102436444
cycle= 68 E= -2353.53526030227  delta_E= 8.83e-09  |g|= 5.89e-05  |ddm|= 0.00169
  HOMO = -0.112021003767907  LUMO = 0.372239174158068
cycle= 69 E= -2353.53526031132  delta_E= -9.04e-09  |g|= 2.32e-05  |ddm|= 0.000602
  HOMO = -0.112021990320144  LUMO = 0.372239075554113
cycle= 70 E= -2353.53526032563  delta_E= -1.43e-08  |g|= 3.96e-05  |ddm|= 0.00115
  HOMO = -0.112022596485426  LUMO = 0.372238978926697
cycle= 71 E= -2353.53526033472  delta_E= -9.09e-09  |g|= 2.96e-05  |ddm|= 0.000821
  HOMO = -0.112022823456732  LUMO = 0.372238880356807
cycle= 72 E= -2353.53526034464  delta_E= -9.93e-09  |g|= 4.03e-05  |ddm|= 0.00113
  HOMO = -0.112024796462045  LUMO = 0.372238964964402
cycle= 73 E= -2353.53526034553  delta_E= -8.86e-10  |g|= 1.09e-05  |ddm|= 6.15e-05
  HOMO = -0.212024064633928  LUMO = 0.172238980763171
Extra cycle  E= -2353.53526034592  delta_E= -3.88e-10  |g|= 1.12e-05  |ddm|= 3.28e-05
converged SCF energy = -2353.53526034592
Attempting SA-DMRGSCF with
40 states with spin multiplicity 2
10 states with spin multiplicity 4

******** <class 'pyscf.mcscf.addons.StateAverageCASSCF'> ********
CAS (5e+2e, 10o), ncore = 47, nvir = 40
max_cycle_macro = 50
max_cycle_micro = 4
conv_tol = 1e-07
conv_tol_grad = None
orbital rotation max_stepsize = 0.02
orbital rotation threshold for CI restart = 0.01
augmented hessian ah_max_cycle = 30
augmented hessian ah_conv_tol = 1e-12
augmented hessian ah_linear dependence = 1e-14
augmented hessian ah_level shift = 1e-08
augmented hessian ah_start_tol = 2.5
augmented hessian ah_start_cycle = 3
augmented hessian ah_grad_trust_region = 3
kf_trust_region = 3
kf_interval = 4
ci_response_space = 4
ci_grad_trust_region = 3
with_dep4 0
natorb = False
canonicalization = True
sorting_mo_energy = False
ao2mo_level = 2
chkfile = /home/Yxwxwx/code/dmet/test/large_44/tmp_64631/tmpu2p79gfy
max_memory 200000 MB (current use 798 MB)
internal_rotation = False

******** Block flags ********
executable             = /home/Yxwxwx/.conda/envs/pyscf_311/bin/block2main
BLOCKEXE_COMPRESS_NEVPT= /path/to/serially/compiled/Block/block.spin_adapted
Block version          = 2.0
mpiprefix              =  
scratchDirectory       = /home/Yxwxwx/code/dmet/test/large_44/tmp_64631/1
integralFile           = /home/Yxwxwx/code/dmet/test/large_44/tmp_64631/1/FCIDUMP
configFile             = /home/Yxwxwx/code/dmet/test/large_44/tmp_64631/1/dmrg.conf
outputFile             = /home/Yxwxwx/code/dmet/test/large_44/tmp_64631/1/dmrg.out
maxIter                = 38
scheduleSweeps         = [0, 4, 8, 12, 14, 16, 18, 20, 22, 24, 26]
scheduleMaxMs          = [200, 400, 800, 1500, 1500, 1500, 1500, 1500, 1500, 1500, 1500]
scheduleTols           = [0.0001, 0.0001, 0.0001, 0.0001, 1e-05, 1.0000000000000002e-06, 1.0000000000000002e-07, 1.0000000000000002e-08, 1.0000000000000003e-09, 1.0000000000000003e-10, 1.0000000000000001e-11]
scheduleNoises         = [0.0001, 0.0001, 0.0001, 0.0001, 1e-05, 1.0000000000000002e-06, 1.0000000000000002e-07, 1.0000000000000002e-08, 1.0000000000000003e-09, 1.0000000000000003e-10, 0.0]
twodot_to_onedot       = 30
tol                    = 1e-10
maxM                   = 1500
dmrg switch tol        = 0.001
wfnsym                 = 1
fullrestart            = False
num_thrds              = 16
memory                 = 200

State-average over 50 states with weights [0.02 0.02 0.02 0.02 0.02 0.02 0.02 0.02 0.02 0.02 0.02 0.02 0.02 0.02
 0.02 0.02 0.02 0.02 0.02 0.02 0.02 0.02 0.02 0.02 0.02 0.02 0.02 0.02
 0.02 0.02 0.02 0.02 0.02 0.02 0.02 0.02 0.02 0.02 0.02 0.02 0.02 0.02
 0.02 0.02 0.02 0.02 0.02 0.02 0.02 0.02]
CASCI E = -2353.10321222404  S^2 = 1.3500000
Set conv_tol_grad to 0.000316228
macro iter   1 ( 21 JK    4 micro), CASSCF E = -2353.25784440768  dE = -1.54632184e-01  S^2 = 1.3500000
               |grad[o]|=0.564  |ddm|=0.0132  |maxRot[o]|=0.312
macro iter   2 ( 21 JK    4 micro), CASSCF E = -2353.38182383199  dE = -1.23979424e-01  S^2 = 1.3500000
               |grad[o]|=0.439  |ddm|=0.0102  |maxRot[o]|=0.312
macro iter   3 ( 21 JK    4 micro), CASSCF E = -2353.45146682852  dE = -6.96429965e-02  S^2 = 1.3500000
               |grad[o]|=0.238  |ddm|=0.00954  |maxRot[o]|=0.306
macro iter   4 ( 21 JK    4 micro), CASSCF E = -2353.48249874482  dE = -3.10319163e-02  S^2 = 1.3500000
               |grad[o]|=0.0723  |ddm|=0.018  |maxRot[o]|=0.309
macro iter   5 ( 11 JK    4 micro), CASSCF E = -2353.48292929600  dE = -4.30551183e-04  S^2 = 1.3500000
               |grad[o]|=0.0105  |ddm|=0.00613  |maxRot[o]|=0.0425
macro iter   6 (  9 JK    4 micro), CASSCF E = -2353.48292953384  dE = -2.37840595e-07  S^2 = 1.3500000
               |grad[o]|=0.000762  |ddm|=0.000296  |maxRot[o]|=0.000603
macro iter   7 (  3 JK    1 micro), CASSCF E = -2353.48292953431  dE = -4.69754013e-10  S^2 = 1.3500000
               |grad[o]|=3.97e-05  |ddm|=9.41e-06  |maxRot[o]|=2.27e-05
1-step CASSCF converged in   7 macro (107 JK  25 micro) steps
CASSCF canonicalization
Density matrix diagonal elements [1.39147238 1.3917716  1.39153124 1.39275781 1.39286046 0.00746731
 0.00833342 0.00802042 0.00728356 0.0085018 ]
CASSCF energy = -2353.48292953431
CASCI E = -2353.48292953431  E(CI) = -22.9557418511927  S^2 = 1.3500000
CASCI state-averaged energy = -2353.48292953431
CASCI energy for each state
  State 0 weight 0.02  E = -2353.54603163552 S^2 = 0.7500000
  State 1 weight 0.02  E = -2353.54303687769 S^2 = 0.7500000
  State 2 weight 0.02  E = -2353.53632147135 S^2 = 0.7500000
  State 3 weight 0.02  E = -2353.53590067913 S^2 = 0.7500000
  State 4 weight 0.02  E = -2353.53407187049 S^2 = 0.7500000
  State 5 weight 0.02  E = -2353.5337954355 S^2 = 0.7500000
  State 6 weight 0.02  E = -2353.53251873638 S^2 = 0.7500000
  State 7 weight 0.02  E = -2353.51748698403 S^2 = 0.7500000
  State 8 weight 0.02  E = -2353.5107630204 S^2 = 0.7500000
  State 9 weight 0.02  E = -2353.51039459337 S^2 = 0.7500000
  State 10 weight 0.02  E = -2353.50762241395 S^2 = 0.7500000
  State 11 weight 0.02  E = -2353.50678391846 S^2 = 0.7500000
  State 12 weight 0.02  E = -2353.49877231216 S^2 = 0.7500000
  State 13 weight 0.02  E = -2353.49806733554 S^2 = 0.7500000
  State 14 weight 0.02  E = -2353.48993968951 S^2 = 0.7500000
  State 15 weight 0.02  E = -2353.48984007005 S^2 = 0.7500000
  State 16 weight 0.02  E = -2353.48950924109 S^2 = 0.7500000
  State 17 weight 0.02  E = -2353.48443101085 S^2 = 0.7500000
  State 18 weight 0.02  E = -2353.4840243942 S^2 = 0.7500000
  State 19 weight 0.02  E = -2353.4833295377 S^2 = 0.7500000
  State 20 weight 0.02  E = -2353.48285910167 S^2 = 0.7500000
  State 21 weight 0.02  E = -2353.47821425896 S^2 = 0.7500000
  State 22 weight 0.02  E = -2353.47764287136 S^2 = 0.7500000
  State 23 weight 0.02  E = -2353.46561802015 S^2 = 0.7500000
  State 24 weight 0.02  E = -2353.46047042791 S^2 = 0.7500000
  State 25 weight 0.02  E = -2353.4600685285 S^2 = 0.7500000
  State 26 weight 0.02  E = -2353.45728799949 S^2 = 0.7500000
  State 27 weight 0.02  E = -2353.45590954384 S^2 = 0.7500000
  State 28 weight 0.02  E = -2353.42047614422 S^2 = 0.7500000
  State 29 weight 0.02  E = -2353.42036578531 S^2 = 0.7500000
  State 30 weight 0.02  E = -2353.41482340141 S^2 = 0.7500000
  State 31 weight 0.02  E = -2353.41361924257 S^2 = 0.7500000
  State 32 weight 0.02  E = -2353.40977579022 S^2 = 0.7500000
  State 33 weight 0.02  E = -2353.40914894671 S^2 = 0.7500000
  State 34 weight 0.02  E = -2353.40163688767 S^2 = 0.7500000
  State 35 weight 0.02  E = -2353.32023103659 S^2 = 0.7500000
  State 36 weight 0.02  E = -2353.31361611823 S^2 = 0.7500000
  State 37 weight 0.02  E = -2353.31129605183 S^2 = 0.7500000
  State 38 weight 0.02  E = -2353.29943180294 S^2 = 0.7500000
  State 39 weight 0.02  E = -2353.29861348839 S^2 = 0.7500000
  State 40 weight 0.02  E = -2353.62676735508 S^2 = 3.7500000
  State 41 weight 0.02  E = -2353.62465906102 S^2 = 3.7500000
  State 42 weight 0.02  E = -2353.59183515508 S^2 = 3.7500000
  State 43 weight 0.02  E = -2353.59136487764 S^2 = 3.7500000
  State 44 weight 0.02  E = -2353.58808110495 S^2 = 3.7500000
  State 45 weight 0.02  E = -2353.58638908526 S^2 = 3.7500000
  State 46 weight 0.02  E = -2353.58140052675 S^2 = 3.7500000
  State 47 weight 0.02  E = -2353.51930907317 S^2 = 3.7500000
  State 48 weight 0.02  E = -2353.5176753844 S^2 = 3.7500000
  State 49 weight 0.02  E = -2353.51524841693 S^2 = 3.7500000
mo_cas.shape =  (720, 10)
sodm1.shape =  (720, 720)
xdmao.shape =  (1273, 1273)
Initializing 4c-HF with Gaunt with gauge for B atom.
Maximum memory cost (2e part) in SCF and amfi calculation: 0.00321078 GB.
1e-integrals time (CPU/WALL): 0.00/0.00 seconds.
2e-Coulomb-integrals time (CPU/WALL): 4.87/0.17 seconds.
2e-Gaunt-integrals time (CPU/WALL): 0.26/0.01 seconds.
2e-gauge-integrals time (CPU/WALL): 0.77/0.03 seconds.

Start Dirac Hartree-Fock iterations...
with SCF convergence = 1e-09


SCF converges after 10 iterations.

Final DHF energy is -24.3666845218543 hartree.
DHF iterations time (CPU/WALL): 1.36/0.04 seconds.
2e-SO Coulomb integrals time (CPU/WALL): 0.26/0.01 seconds.
Initializing 4c-HF with Gaunt with gauge for H atom.
Maximum memory cost (2e part) in SCF and amfi calculation: 4.57763671875e-05 GB.
1e-integrals time (CPU/WALL): 0.00/0.00 seconds.
2e-Coulomb-integrals time (CPU/WALL): 0.00/0.00 seconds.
2e-Gaunt-integrals time (CPU/WALL): 0.00/0.00 seconds.
2e-gauge-integrals time (CPU/WALL): 0.00/0.00 seconds.

Start Dirac Hartree-Fock iterations...
with SCF convergence = 1e-09

Special treatment for fractional occupation of H atom.

SCF converges after 1 iterations.

Final DHF energy is -0.340081496312782 hartree.
DHF iterations time (CPU/WALL): 0.05/0.00 seconds.
2e-SO Coulomb integrals time (CPU/WALL): 0.00/0.00 seconds.
Initializing 4c-HF with Gaunt with gauge for O atom.
Maximum memory cost (2e part) in SCF and amfi calculation: 0.00321078300476074 GB.
1e-integrals time (CPU/WALL): 0.00/0.00 seconds.
2e-Coulomb-integrals time (CPU/WALL): 0.25/0.01 seconds.
2e-Gaunt-integrals time (CPU/WALL): 0.26/0.01 seconds.
2e-gauge-integrals time (CPU/WALL): 0.77/0.03 seconds.

Start Dirac Hartree-Fock iterations...
with SCF convergence = 1e-09


SCF converges after 11 iterations.

Final DHF energy is -74.3107180725906 hartree.
DHF iterations time (CPU/WALL): 1.54/0.05 seconds.
2e-SO Coulomb integrals time (CPU/WALL): 0.25/0.01 seconds.
Initializing 4c-HF with Gaunt with gauge for C atom.
Maximum memory cost (2e part) in SCF and amfi calculation: 0.00321078300476074 GB.
1e-integrals time (CPU/WALL): 0.00/0.00 seconds.
2e-Coulomb-integrals time (CPU/WALL): 0.11/0.01 seconds.
2e-Gaunt-integrals time (CPU/WALL): 0.38/0.01 seconds.
2e-gauge-integrals time (CPU/WALL): 0.90/0.03 seconds.

Start Dirac Hartree-Fock iterations...
with SCF convergence = 1e-09


SCF converges after 10 iterations.

Final DHF energy is -37.3324964757747 hartree.
DHF iterations time (CPU/WALL): 1.54/0.05 seconds.
2e-SO Coulomb integrals time (CPU/WALL): 0.26/0.01 seconds.
Initializing 4c-HF with Gaunt with gauge for N atom.
Maximum memory cost (2e part) in SCF and amfi calculation: 0.00736874341964722 GB.
1e-integrals time (CPU/WALL): 0.00/0.00 seconds.
2e-Coulomb-integrals time (CPU/WALL): 0.49/0.02 seconds.
2e-Gaunt-integrals time (CPU/WALL): 0.64/0.02 seconds.
2e-gauge-integrals time (CPU/WALL): 1.79/0.06 seconds.

Start Dirac Hartree-Fock iterations...
with SCF convergence = 1e-09


SCF converges after 12 iterations.

Final DHF energy is -53.8754539020806 hartree.
DHF iterations time (CPU/WALL): 2.91/0.09 seconds.
2e-SO Coulomb integrals time (CPU/WALL): 0.38/0.01 seconds.
Initializing 4c-HF with Gaunt with gauge for CO atom.
Maximum memory cost (2e part) in SCF and amfi calculation: 0.0711967349052429 GB.
1e-integrals time (CPU/WALL): 0.00/0.00 seconds.
2e-Coulomb-integrals time (CPU/WALL): 3.24/0.11 seconds.
2e-Gaunt-integrals time (CPU/WALL): 2.56/0.08 seconds.
2e-gauge-integrals time (CPU/WALL): 6.44/0.21 seconds.

Start Dirac Hartree-Fock iterations...
with SCF convergence = 1e-09


SCF converges after 18 iterations.

Final DHF energy is -1390.51515626882 hartree.
DHF iterations time (CPU/WALL): 23.47/0.79 seconds.
2e-SO Coulomb integrals time (CPU/WALL): 3.44/0.11 seconds.
hso1e.shape =  (3, 720, 720)
hso2e.shape =  (3, 720, 720)
hso.shape =  (3, 10, 10)
