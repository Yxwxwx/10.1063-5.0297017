[DEBUG] 临时目录已设置为：/home/Yxwxwx/code/dmet/test/large_1/tmp_63721
#INFO: **** input file is /home/Yxwxwx/code/dmet/test/large_1/dmet_siso.py ****
from pyscf import gto, scf, ao2mo, mcscf, fci, dmrgscf, lib
# from pyscf.csf_fci import csf_solver  # TODO:
from pyscf.mcscf import avas
from pyscf.tools import molden, fcidump
from pyscf.lib import logger, cho_solve
from pyscf.data import nist
import numpy as np
import scipy
from functools import reduce
import os
import tempfile
from liblan.utils.rdiis import tag_rdiis_

dmrgscf.settings.BLOCKEXE = os.popen("which block2main").read().strip()
dmrgscf.settings.MPIPREFIX = " "

def set_custom_tmpdir(workdir):
    # 动态获取Slurm分配的作业ID（当在Slurm环境下运行时）
    slurm_job_id = os.getenv('SLURM_JOB_ID', 'localrun')
    
    # 构建唯一临时目录路径
    custom_tmp = os.path.abspath( 
        os.path.join(workdir, f"tmp_{slurm_job_id}") 
    )
    
    # 确保目录存在
    os.makedirs(custom_tmp, exist_ok=True)
    
    # 双重配置方案：修改PySCF参数 + 重定向环境变量
    lib.param.TMPDIR = custom_tmp
    os.environ['TMPDIR'] = custom_tmp  # 覆盖系统环境变量
    tempfile.tempdir = custom_tmp      # 影响Python标准库的临时文件
    
    print(f"[DEBUG] 临时目录已设置为：{custom_tmp}")

current_workdir = os.path.dirname(os.path.abspath(__file__))
set_custom_tmpdir(current_workdir)
def read_cas_info(fname):
    with open(fname, "r") as f1:
        ncasorb, ncaselec = [int(x) for x in f1.readline().split(" ")]
        casorbind = [int(x) for x in f1.readline().split(" ")]
        statelis = [int(x) for x in f1.readline().split(" ")]
    return ncasorb, ncaselec, casorbind, statelis


def rohf_solve_imp(hcore, eris, nelec, spin, max_mem, dm0=None, verbose=logger.INFO):
    mol = gto.M()
    mol.verbose = verbose
    mol.incore_anyway = True
    mol.nelectron = nelec
    mol.spin = spin

    nao = hcore.shape[0]
    print("nao = ", nao)
    print("nelec = ", mol.nelec)

    mf = scf.rohf.ROHF(mol).x2c()
    mf.max_memory = max_mem
    mf.mo_energy = np.zeros((nao))
    mf.max_cycle = 1000
    mf.diis_space = 8
    mf.init_guess = "1e"
    mf.level_shift = 0.2

    mf.get_hcore = lambda *args: hcore
    mf.get_ovlp = lambda *args: np.eye(nao)
    mf._eri = ao2mo.restore(8, eris, nao)

    if dm0 is None:
        mf.kernel()
    else:
        if dm0.shape != hcore.shape:
            bath_size = hcore.shape[0] - dm0.shape[0]
            dm0 = scipy.linalg.block_diag(
                dm0, np.eye(bath_size) * (nelec - np.trace(dm0)) / bath_size
            )
        mf.kernel(dm0)
    return mf


def sacasscf_solve_imp(
    solver_base, mol, ncasorb, ncaselec, casorbind, statelis, avas=False
):
    solver = mcscf.CASSCF(solver_base, ncasorb, ncaselec)

    if avas:
        mo = casorbind
    else:
        mo = solver.sort_mo(casorbind)
    mcfs = []
    logger.info(solver, "Attempting SA-DMRGSCF with")
    for i in range(len(statelis)):
        if statelis[i] != 0:
            new_mcf = dmrgscf.DMRGCI(mol, maxM=1500, tol=1e-10)
            new_mcf.spin = i
            new_mcf.nroots = statelis[i]
            new_mcf.threads = 16
            new_mcf.memory = int(mol.max_memory / 1000)
            new_mcf.block_extra_keyword = [
                "real_density_matrix",
                "davidson_soft_max_iter 1600",
                "noreorder",
                "cutoff 1E-24",
            ]
            new_mcf.runtimeDir = lib.param.TMPDIR + "/%d" % i
            new_mcf.scratchDirectory = lib.param.TMPDIR + "/%d" % i
            mcfs.append(new_mcf)
            logger.info(
                solver, "%s states with spin multiplicity %s", statelis[i], i + 1
            )

    statetot = sum(statelis)
    mcscf.state_average_mix_(solver, mcfs, np.ones(statetot) / statetot)
    solver.run(mo, verbose=mol.verbose)
    return solver


def lowdin(s):
    """new basis is |mu> c^{lowdin}_{mu i}"""
    e, v = scipy.linalg.eigh(s)
    idx = e > 1e-15
    return np.dot(v[:, idx] / np.sqrt(e[idx]), v[:, idx].conj().T)


def caolo(s):
    return lowdin(s)


def cloao(s):
    return lowdin(s) @ s


def get_dmet_as_props(mf, imp_inds, lo_meth="lowdin", thres=1e-13):
    """
    Returns C(AO->AS), entropy loss, and orbital composition
    """
    s = mf.get_ovlp()
    caolo_mat, cloao_mat = caolo(s), cloao(s)
    env_inds = [x for x in range(s.shape[0]) if x not in imp_inds]

    if mf.mol.spin == 0:
        pass
    else:
        dma, dmb = mf.make_rdm1()

        ldma = reduce(np.dot, (cloao_mat, dma, cloao_mat.conj().T))
        ldmb = reduce(np.dot, (cloao_mat, dmb, cloao_mat.conj().T))

        ldma_env = ldma[env_inds, :][:, env_inds]
        ldmb_env = ldmb[env_inds, :][:, env_inds]

        nat_occa, nat_coeffa = np.linalg.eigh(ldma_env)
        nat_occb, nat_coeffb = np.linalg.eigh(ldmb_env)

        ldmr_env = ldma_env + ldmb_env
        nat_occr, nat_coeffr = np.linalg.eigh(ldmr_env)

        caoas = np.hstack([caolo_mat[:, imp_inds], caolo_mat[:, env_inds] @ nat_coeffr])

        nuu = np.sum([nat_occr < thres])
        ne = np.sum([(nat_occr >= thres) & (nat_occr <= 2 - thres)])
        nuo = np.sum([nat_occr > 2 - thres])

        asorbs = (nuu, ne, nuo)
        print("caoas.shape = ", caoas.shape)
        print("asorbs = ", asorbs)

        nat_occa = nat_occa[nat_occa > thres]
        nat_occb = nat_occb[nat_occb > thres]
        nat_occr = nat_occr[nat_occr > thres]

        ent = -np.sum(nat_occa * np.log(nat_occa)) - np.sum(nat_occb * np.log(nat_occb))
        entr = -2 * np.sum(nat_occr / 2 * np.log(nat_occr / 2))

        return caoas, entr - ent, asorbs


def get_dmet_imp_ldm(mf, imp_inds, lo_meth="lowdin"):
    """
    Returns better initial guess than '1e' for impurity
    """
    s = mf.get_ovlp()
    caolo_mat, cloao_mat = caolo(s), cloao(s)

    dma, dmb = mf.make_rdm1()

    ldm = reduce(np.dot, (cloao_mat, (dma + dmb), cloao_mat.conj().T))[imp_inds, :][
        :, imp_inds
    ]
    return ldm


def get_as_1e_ints(mf, caoas, asorbs):
    # hcore from mf
    hcore = mf.get_hcore()

    # HF J/K from env UO
    uos = hcore.shape[0] - asorbs[-1]
    dm_uo = caoas[:, uos:] @ caoas[:, uos:].conj().T * 2
    vj, vk = mf.get_jk(dm=dm_uo)

    fock = hcore + vj - 0.5 * vk

    nimp = hcore.shape[0] - np.sum(asorbs)
    act_inds = [
        *list(range(nimp)),
        *list(range(nimp + asorbs[0], nimp + asorbs[0] + asorbs[1])),
    ]

    asints1e = reduce(np.dot, (caoas[:, act_inds].conj().T, fock, caoas[:, act_inds]))
    return asints1e


def get_as_2e_ints(mf, caoas, asorbs):
    nimp = caoas.shape[0] - np.sum(asorbs)
    act_inds = [
        *list(range(nimp)),
        *list(range(nimp + asorbs[0], nimp + asorbs[0] + asorbs[1])),
    ]

    if mf._eri is not None:
        asints2e = ao2mo.full(mf._eri, caoas[:, act_inds])
    else:
        asints2e = ao2mo.full(mf.mol, caoas[:, act_inds])

    return asints2e


def get_bp_hso2e(mol, dm0):
    hso2e = mol.intor("int2e_p1vxp1", 3).reshape(3, mol.nao, mol.nao, mol.nao, mol.nao)
    vj = np.einsum("yijkl,lk->yij", hso2e, dm0, optimize=True)
    vk = np.einsum("yijkl,jk->yil", hso2e, dm0, optimize=True)
    vk += np.einsum("yijkl,li->ykj", hso2e, dm0, optimize=True)
    return vj, vk


def get_bp_hso2e_amfi(mol, dm0):
    """atomic-mean-field approximation"""
    ao_loc = mol.ao_loc_nr()
    nao = ao_loc[-1]
    vj = np.zeros((3, nao, nao))
    vk = np.zeros((3, nao, nao))
    import copy

    atom = copy.copy(mol)
    aoslice = mol.aoslice_by_atom(ao_loc)
    for ia in range(mol.natm):
        b0, b1, p0, p1 = aoslice[ia]
        atom._bas = mol._bas[b0:b1]
        vj1, vk1 = get_bp_hso2e(atom, dm0[p0:p1, p0:p1])
        vj[:, p0:p1, p0:p1] = vj1
        vk[:, p0:p1, p0:p1] = vk1
    return vj, vk


mol = gto.M(
    atom="""
            Co   1.506499   10.764206    0.414024
            S    0.900702   12.969251    0.863740
            S   -0.630821    9.850987    0.263627
            S    2.753892   10.415545   -1.502746
            S    3.027943    9.878195    1.923416
            C    2.377311   13.975173    0.913216
            C    2.276518   15.365718    0.836418
            H    1.444112   15.762234    0.713835
            C    3.399137   16.154649    0.937832
            H    3.312247   17.078944    0.888601
            C    4.645140   15.606362    1.112844
            H    5.397607   16.149181    1.179058
            C    4.758096   14.244532    1.186689
            H    5.597454   13.867157    1.321825
            C    3.649380   13.407744    1.065829
            H    3.753648   12.483449    1.085522
            C   -0.483108    8.032887    0.187074
            C   -1.603989    7.293178    0.071383
            H   -2.422493    7.725245   -0.019692
            C   -1.574447    5.919042    0.086153
            H   -2.366884    5.440487    0.000000
            C   -0.364938    5.235392    0.231381
            H   -0.335395    4.306995    0.285534
            C    0.776797    5.988774    0.292919
            H    1.598776    5.558075    0.347072
            C    0.738565    7.384787    0.273226
            H    1.527526    7.875648    0.319995
            C    2.008897   11.246043   -2.857063
            C    0.792437   11.947467   -2.723896
            H    0.359725   11.969345   -1.900278
            C    0.238079   12.605139   -3.809910
            H   -0.559572   13.071388   -3.704557
            C    0.851522   12.577793   -5.050260
            H    0.465730   13.018063   -5.772218
            C    2.036702   11.896878   -5.208288
            H    2.450298   11.872266   -6.040521
            C    2.615389   11.247410   -4.127935
            H    3.423466   10.801671   -4.246087
            C    2.286945    9.211500    3.375947
            C    3.044626    9.114422    4.556237
            H    3.906575    9.464451    4.578390
            C    2.530237    8.503239    5.693449
            H    3.049839    8.432139    6.461437
            C    1.239051    8.001440    5.679173
            H    0.886278    7.585780    6.431899
            C    0.479633    8.125864    4.519314
            H   -0.391005    7.797712    4.514391
            C    0.962741    8.709702    3.404255
            H    0.424023    8.782168    2.648574
        """,
    basis={"default": "def2tzvp", "C": "6-31G*", "H": "6-31G*"},
    symmetry=0,
    spin=3,
    charge=-2,
    verbose=4,
    max_memory=200000,
)

mf = scf.rohf.ROHF(mol).x2c()
mf.max_cycle = 100
title = "CoSPh4"
imp_inds = mol.search_ao_label(["Co *"])
mf.chkfile = title + "_rohf.chk"
mf.init_guess = "atom"
mf.level_shift = 0.2
if os.path.isfile(title + "_rohf.chk"):
    mf.init_guess = "chk"
    mf.level_shift = 0.0
mf = tag_rdiis_(mf=mf, imp_inds=imp_inds)
mf.kernel()

print("nao = ", mol.nao_nr())
print("nelec = ", mol.nelec)


print("imp_inds.shape", imp_inds.shape)

# AS general info
caoas, ent, asorbs = get_dmet_as_props(mf, imp_inds, thres=1e-13)
# AS hcore + j/k
as1e = get_as_1e_ints(mf, caoas, asorbs)
# AS ERIs
as2e = get_as_2e_ints(mf, caoas, asorbs)

print(f"Entanglement S: {ent:.3f}")

nimp = caoas.shape[0] - np.sum(asorbs)
print("nimp = ", nimp)
act_inds = [
    *list(range(nimp)),
    *list(range(nimp + asorbs[0], nimp + asorbs[0] + asorbs[1])),
]

print("act_inds = ", act_inds)

nelec = int(mf.mol.nelectron - asorbs[-1] * 2)
ldm = get_dmet_imp_ldm(mf, imp_inds)
solver_base = rohf_solve_imp(as1e, as2e, nelec, mf.mol.spin, mf.max_memory, dm0=ldm)

with open(title + "_imp_rohf_orbs.molden", "w") as f1:
    molden.header(mf.mol, f1)
    molden.orbital_coeff(
        mf.mol,
        f1,
        caoas[:, act_inds] @ solver_base.mo_coeff,
        ene=solver_base.mo_energy,
        occ=solver_base.mo_occ,
    )

# avas
# ao_labels = ["Co 3d"]
# ncasorb, ncaselec, casorbind = avas.avas(solver_base, ao_labels, canonicalize=False)

# ncasorb = 5
# ncaselec = 7
# casorbind = [40, 41, 55, 56, 57]  # F-style

casinfo_fname = title + "_cas_info"


if not os.path.isfile(casinfo_fname):
    print("Failed to read saved CAS briefings.")
    exit()


ncasorb, ncaselec, casorbind, statelis = read_cas_info(casinfo_fname)

solver = sacasscf_solve_imp(
    solver_base, mf.mol, ncasorb, ncaselec, casorbind, statelis=statelis
)

mc = solver.copy()
fcidump.from_integrals(
    "FCIDUMP",
    solver.get_h1eff()[0],
    solver.get_h2eff(),
    solver.ncas,
    solver.nelecas,
    nuc=solver.get_h1eff()[1],
)

# dm = solver.make_rdm1()
# print("dm.shape = ", dm.shape)

# casinfo_fname_large = title + "_cas_info_large"

# if not os.path.isfile(casinfo_fname_large):
#     print("Failed to read saved Large CAS briefings.")
#     exit()
# ncasorb_large, ncaselec_large, casorbind_large, statelis_large = read_cas_info(
#     casinfo_fname
# )
# solver.ncas = ncasorb_large
# solver.nelecas = ncaselec_large
# solver.mo_coeff = solver.sort_mo(casorbind_large, solver.mo_coeff)
# fcidump.from_integrals(
#     "FCIDUMP_1",
#     solver.get_h1eff()[0],
#     solver.get_h2eff(),
#     solver.ncas,
#     solver.nelecas,
#     nuc=mc.get_h1eff()[1],
# )

# with open("cas.molden", "w") as f1:
#     molden.header(mol, f1)
#     molden.orbital_coeff(
#         mol,
#         f1,
#         caoas[:, act_inds] @ solver.mo_coeff,
#         ene=solver_base.mo_energy,
#         occ=solver_base.mo_occ,
#     )


uos = caoas.shape[0] - asorbs[-1]
dm_uo = caoas[:, uos:] @ caoas[:, uos:].conj().T * 2
mo_cas = caoas[:, act_inds] @ mc.mo_coeff[:, mc.ncore : mc.ncore + mc.ncas]
print("mo_cas.shape = ", mo_cas.shape)
sodm1_act = reduce(
    np.dot, [caoas[:, act_inds], mc.make_rdm1(), caoas[:, act_inds].conj().T]
)
sodm1 = sodm1_act + dm_uo

# soc integral
# breit-pauli amfi
# amfi = True
# hso1e = mol.intor_asymmetric("int1e_pnucxp", 3)
# vj, vk = get_bp_hso2e_amfi(mol, sodm1) if amfi else get_bp_hso2e(mol, sodm1)
# hso2e = vj - vk * 1.5
# hsoao = 1.0j * (nist.ALPHA**2 / 2) * (hso1e + hso2e)
# print("hsoao.shape = ", hsoao.shape)

# hso = np.asarray([reduce(np.dot, (mo_cas.T, x.T, mo_cas)) for x in hsoao])
# print("hso.shape = ", hso.shape)
# # Save each component of hso (shape: 3 x nao x nao) to separate binary files as complex128
# hso[0].astype(np.complex128).tofile("hso_x.bin")
# hso[1].astype(np.complex128).tofile("hso_y.bin")
# hso[2].astype(np.complex128).tofile("hso_z.bin")

# x2camf
from mycamf import x2camf
import os

xmol, ctr = mf.with_x2c.get_xmol(mol)
xdmao = ctr @ sodm1 @ ctr.conj().T
print("sodm1.shape = ", sodm1.shape)
print("xdmao.shape = ", xdmao.shape)
x = mf.with_x2c.get_xmat()
r = mf.with_x2c._get_rmat(x=x)
hso1e = xmol.intor_asymmetric("int1e_pnucxp", 3)
hso1e = np.einsum(
    "pq,qr,irs,sk,kl->ipl", r.conj().T, x.conj().T, hso1e, x, r, optimize=True
)

hso2e = x2camf.amfi(mf.with_x2c, printLevel=1)

hso2e = hso2e / (nist.ALPHA**2 / 4)
sphsp = xmol.sph2spinor_coeff()
p_repr = np.einsum("ixp,pq,jyq->ijxy", sphsp, hso2e, sphsp.conj(), optimize=True)
hso2e = (p_repr[0, np.array([1, 1, 0])] * np.array([-1j, 1, -1j])[:, None, None]).real

s22 = xmol.intor_symmetric("int1e_ovlp")
s21 = gto.intor_cross("int1e_ovlp", xmol, mol)
c = cho_solve(s22, s21)
hso1e = c.conj().T @ hso1e @ c
hso2e = c.conj().T @ hso2e @ c
print("hso1e.shape = ", hso1e.shape)
print("hso2e.shape = ", hso2e.shape)
hsoao = (1j * nist.ALPHA**2 / 2) * (hso1e + hso2e)

hso = np.asarray([reduce(np.dot, (mo_cas.T.conj(), i.T, mo_cas)) for i in hsoao])
print("hso.shape = ", hso.shape)
# Save each component of hso (shape: 3 x nao x nao) to separate binary files as complex128
hso_labels = ["x", "y", "z"]
for i, label in enumerate(hso_labels):
    with open(f"hso_{label}.bin", "wb") as f:
        # 先写入shape信息（int32），再写入数据（complex128）
        shape = np.array(hso[i].shape, dtype=np.int32)
        f.write(shape.tobytes())
        f.write(hso[i].astype(np.complex128).tobytes())
        # print(hso[i])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cu10', release='5.15.0-133-generic', version='#144-Ubuntu SMP Fri Feb 7 20:47:38 UTC 2025', machine='x86_64')  Threads 16
Python 3.13.2 | packaged by Anaconda, Inc. | (main, Feb  6 2025, 18:56:02) [GCC 11.2.0]
numpy 2.2.6  scipy 1.15.3  h5py 3.13.0
Date: Thu Jun 26 20:44:58 2025
PySCF version 2.9.0
PySCF path  /home/Yxwxwx/.conda/envs/my_pyscf/lib/python3.13/site-packages/pyscf

[CONFIG] conf_file None
[INPUT] verbose = 4
[INPUT] num. atoms = 49
[INPUT] num. electrons = 257
[INPUT] charge = -2
[INPUT] spin (= nelec alpha-beta = 2S) = 3
[INPUT] symmetry 0 subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Co     1.506499000000  10.764206000000   0.414024000000 AA    2.846870516931  20.341401288400   0.782391968997 Bohr   0.0
[INPUT]  2 S      0.900702000000  12.969251000000   0.863740000000 AA    1.702080099848  24.508332430742   1.632232042832 Bohr   0.0
[INPUT]  3 S     -0.630821000000   9.850987000000   0.263627000000 AA   -1.192078923624  18.615667486651   0.498182829041 Bohr   0.0
[INPUT]  4 S      2.753892000000  10.415545000000  -1.502746000000 AA    5.204101656631  19.682527488083  -2.839778374786 Bohr   0.0
[INPUT]  5 S      3.027943000000   9.878195000000   1.923416000000 AA    5.721982990794  18.667083155048   3.634729463606 Bohr   0.0
[INPUT]  6 C      2.377311000000  13.975173000000   0.913216000000 AA    4.492466702916  26.409249513416   1.725728132571 Bohr   0.0
[INPUT]  7 C      2.276518000000  15.365718000000   0.836418000000 AA    4.301995537643  29.036998727300   1.580600945656 Bohr   0.0
[INPUT]  8 H      1.444112000000  15.762234000000   0.713835000000 AA    2.728976173198  29.786305371308   1.348952648129 Bohr   0.0
[INPUT]  9 C      3.399137000000  16.154649000000   0.937832000000 AA    6.423437989876  30.527862248479   1.772245630853 Bohr   0.0
[INPUT] 10 H      3.312247000000  17.078944000000   0.888601000000 AA    6.259239686912  32.274526656784   1.679212524015 Bohr   0.0
[INPUT] 11 C      4.645140000000  15.606362000000   1.112844000000 AA    8.778042410262  29.491749980819   2.102970379365 Bohr   0.0
[INPUT] 12 H      5.397607000000  16.149181000000   1.179058000000 AA   10.199998958035  30.517529226030   2.228096704977 Bohr   0.0
[INPUT] 13 C      4.758096000000  14.244532000000   1.186689000000 AA    8.991498314389  26.918264252603   2.242517205034 Bohr   0.0
[INPUT] 14 H      5.597454000000  13.867157000000   1.321825000000 AA   10.577655054851  26.205128856345   2.497887234603 Bohr   0.0
[INPUT] 15 C      3.649380000000  13.407744000000   1.065829000000 AA    6.896328724465  25.336964108280   2.014124905619 Bohr   0.0
[INPUT] 16 H      3.753648000000  12.483449000000   1.085522000000 AA    7.093366688021  23.590299699976   2.051339282190 Bohr   0.0
[INPUT] 17 C     -0.483108000000   8.032887000000   0.187074000000 AA   -0.912941808586  15.179956419579   0.353518625027 Bohr   0.0
[INPUT] 18 C     -1.603989000000   7.293178000000   0.071383000000 AA   -3.031099916815  13.782108997703   0.134894319950 Bohr   0.0
[INPUT] 19 H     -2.422493000000   7.725245000000  -0.019692000000 AA   -4.577848308676  14.598597295166  -0.037212486845 Bohr   0.0
[INPUT] 20 C     -1.574447000000   5.919042000000   0.086153000000 AA   -2.975273627643  11.185368299798   0.162805574810 Bohr   0.0
[INPUT] 21 H     -2.366884000000   5.440487000000   0.000000000000 AA   -4.472762528615  10.281030414257   0.000000000000 Bohr   0.0
[INPUT] 22 C     -0.364938000000   5.235392000000   0.231381000000 AA   -0.689632872447   9.893457034739   0.437246720428 Bohr   0.0
[INPUT] 23 H     -0.335395000000   4.306995000000   0.285534000000 AA   -0.633804693548   8.139040969871   0.539581059252 Bohr   0.0
[INPUT] 24 C      0.776797000000   5.988774000000   0.292919000000 AA    1.467933584384  11.317142681916   0.553536686681 Bohr   0.0
[INPUT] 25 H      1.598776000000   5.558075000000   0.347072000000 AA    3.021248774528  10.503239529792   0.655871025505 Bohr   0.0
[INPUT] 26 C      0.738565000000   7.384787000000   0.273226000000 AA    1.395685575189  13.955224918248   0.516322310110 Bohr   0.0
[INPUT] 27 H      1.527526000000   7.875648000000   0.319995000000 AA    2.886605788152  14.882817773479   0.604702911230 Bohr   0.0
[INPUT] 28 C      2.008897000000  11.246043000000  -2.857063000000 AA    3.796265142460  21.251941255082  -5.399066590628 Bohr   0.0
[INPUT] 29 C      0.792437000000  11.947467000000  -2.723896000000 AA    1.497488900972  22.577440512279  -5.147417431798 Bohr   0.0
[INPUT] 30 H      0.359725000000  11.969345000000  -1.900278000000 AA    0.679781730159  22.618783940432  -3.591004980536 Bohr   0.0
[INPUT] 31 C      0.238079000000  12.605139000000  -3.809910000000 AA    0.449904106010  23.820260472074  -7.199686459242 Bohr   0.0
[INPUT] 32 H     -0.559572000000  13.071388000000  -3.704557000000 AA   -1.057437826975  24.701343387926  -7.000598142840 Bohr   0.0
[INPUT] 33 C      0.851522000000  12.577793000000  -5.050260000000 AA    1.609143369042  23.768584021472  -9.543608257846 Bohr   0.0
[INPUT] 34 H      0.465730000000  13.018063000000  -5.772218000000 AA    0.880102147994  24.600573742334 -10.907911151285 Bohr   0.0
[INPUT] 35 C      2.036702000000  11.896878000000  -5.208288000000 AA    3.848808977354  22.481841157363  -9.842237897859 Bohr   0.0
[INPUT] 36 H      2.450298000000  11.872266000000  -6.040521000000 AA    4.630392143570  22.435331217986 -11.414930339684 Bohr   0.0
[INPUT] 37 C      2.615389000000  11.247410000000  -4.127935000000 AA    4.942368919200  21.254524510694  -7.800666610006 Bohr   0.0
[INPUT] 38 H      3.423466000000  10.801671000000  -4.246087000000 AA    6.469413136760  20.412199877657  -8.023941531076 Bohr   0.0
[INPUT] 39 C      2.286945000000   9.211500000000   3.375947000000 AA    4.321699711943  17.407212196431   6.379615241047 Bohr   0.0
[INPUT] 40 C      3.044626000000   9.114422000000   4.556237000000 AA    5.753509291730  17.223761363711   8.610040088610 Bohr   0.0
[INPUT] 41 H      3.906575000000   9.464451000000   4.578390000000 AA    7.382356835073  17.885220309366   8.651903191447 Bohr   0.0
[INPUT] 42 C      2.530237000000   8.503239000000   5.693449000000 AA    4.781454960241  16.068792881720  10.759059314179 Bohr   0.0
[INPUT] 43 H      3.049839000000   8.432139000000   6.461437000000 AA    5.763360434017  15.934433354264  12.210346301131 Bohr   0.0
[INPUT] 44 C      1.239051000000   8.001440000000   5.679173000000 AA    2.341467044368  15.120530202140  10.732081584025 Bohr   0.0
[INPUT] 45 H      0.886278000000   7.585780000000   6.431899000000 AA    1.674822690227  14.335046641203  12.154527570864 Bohr   0.0
[INPUT] 46 C      0.479633000000   8.125864000000   4.519314000000 AA    0.906375010304  15.355657485463   8.540265730913 Bohr   0.0
[INPUT] 47 H     -0.391005000000   7.797712000000   4.514391000000 AA   -0.738892363336  14.735540078234   8.530962609201 Bohr   0.0
[INPUT] 48 C      0.962741000000   8.709702000000   3.404255000000 AA    1.819316818890  16.458951406577   6.433109608181 Bohr   0.0
[INPUT] 49 H      0.424023000000   8.782168000000   2.648574000000 AA    0.801287340516  16.595892299919   5.005079480644 Bohr   0.0

nuclear repulsion = 3883.49561326911
number of shells = 251
number of NR pGTOs = 1072
number of NR cGTOs = 569
basis = {'default': 'def2tzvp', 'C': '6-31G*', 'H': '6-31G*'}
ecp = {}
CPU time:         2.96


******** <class 'pyscf.x2c.sfx2c1e.sfX2C1eROHF'> ********
method = sfX2C1eROHF
initial guess = chk
damping factor = 0
level_shift factor = 0.0
DIIS = <class 'liblan.utils.rdiis.tag_rdiis_.<locals>.RDIIS'>
diis_start_cycle = 1
diis_space = 8
diis_damp = 0
SCF conv_tol = 1e-09
SCF conv_tol_grad = None
SCF max_cycles = 100
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = CoSPh4_rohf.chk
max_memory 200000 MB (current use 139 MB)
num. doubly occ = 127  num. singly occ = 3


******** <class 'pyscf.x2c.sfx2c1e.SpinFreeX2CHelper'> ********
approx = 1e
xuncontract = 1
Set gradient conv threshold to 3.16228e-05
init E= -3904.54016516912
  HOMO = 0.119763278439839  LUMO = 0.343093590680486
cycle= 1 E= -3904.54016516912  delta_E= -1.82e-12  |g|= 3.4e-06  |ddm|= 7.69e-06
  HOMO = 0.119763479622494  LUMO = 0.343093626448163
Extra cycle  E= -3904.54016516907  delta_E= 4.91e-11  |g|= 6.6e-06  |ddm|= 1.48e-05
converged SCF energy = -3904.54016516907
nao =  569
nelec =  (130, 127)
imp_inds.shape (45,)
caoas.shape =  (569, 569)
asorbs =  (np.int64(394), np.int64(53), np.int64(77))
Entanglement S: 0.022
nimp =  45
act_inds =  [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 439, 440, 441, 442, 443, 444, 445, 446, 447, 448, 449, 450, 451, 452, 453, 454, 455, 456, 457, 458, 459, 460, 461, 462, 463, 464, 465, 466, 467, 468, 469, 470, 471, 472, 473, 474, 475, 476, 477, 478, 479, 480, 481, 482, 483, 484, 485, 486, 487, 488, 489, 490, 491]
nao =  98
nelec =  (53, 50)


******** <class 'pyscf.x2c.sfx2c1e.sfX2C1eROHF'> ********
method = sfX2C1eROHF
initial guess = 1e
damping factor = 0
level_shift factor = 0.2
DIIS = <class 'pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 8
diis_damp = 0
SCF conv_tol = 1e-09
SCF conv_tol_grad = None
SCF max_cycles = 1000
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = /home/Yxwxwx/code/dmet/test/large_1/tmp_63721/tmplf47fl79
max_memory 200000 MB (current use 105850 MB)
num. doubly occ = 50  num. singly occ = 3


******** <class 'pyscf.x2c.sfx2c1e.SpinFreeX2CHelper'> ********
approx = 1e
xuncontract = 1
Set gradient conv threshold to 3.16228e-05
init E= -2298.65715410475
  HOMO = 1.40809100573478  LUMO = 1.44467296840022
cycle= 1 E= -2383.22359755127  delta_E= -84.6  |g|= 4.78  |ddm|= 10.1

WARN: HOMO -0.275274380026699 >= LUMO -0.290954260652743

cycle= 2 E= -2357.11058549768  delta_E= 26.1  |g|= 15.8  |ddm|= 5.69

WARN: HOMO 0.0311441476274416 >= LUMO -0.0387710244623265

cycle= 3 E= -2377.18336109266  delta_E= -20.1  |g|= 10.5  |ddm|= 2.36
  HOMO = 0.0534031151912636  LUMO = 0.132735416358841
cycle= 4 E= -2384.20915433838  delta_E= -7.03  |g|= 7.92  |ddm|= 1.67
  HOMO = -0.0169725068810567  LUMO = 0.409925149264509
cycle= 5 E= -2387.32542735096  delta_E= -3.12  |g|= 6.19  |ddm|= 0.74
  HOMO = 0.066965146497318  LUMO = 0.582048047111376
cycle= 6 E= -2390.1997782034  delta_E= -2.87  |g|= 4.11  |ddm|= 0.844
  HOMO = 0.155007465415403  LUMO = 0.73411856902493
cycle= 7 E= -2391.84380117333  delta_E= -1.64  |g|= 2.39  |ddm|= 0.806
  HOMO = 0.270901612793633  LUMO = 0.775448386018604
cycle= 8 E= -2392.80912296217  delta_E= -0.965  |g|= 0.912  |ddm|= 0.936
  HOMO = 0.440539920442657  LUMO = 0.80248107555667
cycle= 9 E= -2393.23940140564  delta_E= -0.43  |g|= 0.244  |ddm|= 1.01
  HOMO = 0.36313691391584  LUMO = 0.809709655256373
cycle= 10 E= -2393.36912219282  delta_E= -0.13  |g|= 0.471  |ddm|= 0.769
  HOMO = 0.309657198179192  LUMO = 0.804899624303924
cycle= 11 E= -2393.42523566213  delta_E= -0.0561  |g|= 0.491  |ddm|= 0.36
  HOMO = 0.281927042241913  LUMO = 0.79939133891586
cycle= 12 E= -2393.45952684968  delta_E= -0.0343  |g|= 0.389  |ddm|= 0.197
  HOMO = 0.217648207083011  LUMO = 0.782470378462014
cycle= 13 E= -2393.49456445087  delta_E= -0.035  |g|= 0.102  |ddm|= 0.276
  HOMO = 0.209897554006522  LUMO = 0.778886782471875
cycle= 14 E= -2393.49924169075  delta_E= -0.00468  |g|= 0.0254  |ddm|= 0.143
  HOMO = 0.220147654279297  LUMO = 0.780956871837083
cycle= 15 E= -2393.49966636782  delta_E= -0.000425  |g|= 0.0158  |ddm|= 0.0454
  HOMO = 0.220452514935719  LUMO = 0.78174342473732
cycle= 16 E= -2393.49993856963  delta_E= -0.000272  |g|= 0.00929  |ddm|= 0.0286
  HOMO = 0.221583100362091  LUMO = 0.781792719772269
cycle= 17 E= -2393.50001781745  delta_E= -7.92e-05  |g|= 0.0101  |ddm|= 0.0301
  HOMO = 0.220310601038396  LUMO = 0.781514134776251
cycle= 18 E= -2393.500160049  delta_E= -0.000142  |g|= 0.00628  |ddm|= 0.0155
  HOMO = 0.219538124317535  LUMO = 0.781393856839305
cycle= 19 E= -2393.50031546625  delta_E= -0.000155  |g|= 0.00467  |ddm|= 0.0246
  HOMO = 0.219356753757539  LUMO = 0.781403247752723
cycle= 20 E= -2393.50048006124  delta_E= -0.000165  |g|= 0.00399  |ddm|= 0.033
  HOMO = 0.219084055160763  LUMO = 0.781383532556504
cycle= 21 E= -2393.50057672234  delta_E= -9.67e-05  |g|= 0.00327  |ddm|= 0.0236
  HOMO = 0.218747931689701  LUMO = 0.781361888914396
cycle= 22 E= -2393.50066777883  delta_E= -9.11e-05  |g|= 0.00278  |ddm|= 0.0256
  HOMO = 0.218740034550307  LUMO = 0.781375797281226
cycle= 23 E= -2393.50071312498  delta_E= -4.53e-05  |g|= 0.0027  |ddm|= 0.0133
  HOMO = 0.218835662740213  LUMO = 0.781399072900049
cycle= 24 E= -2393.50075960805  delta_E= -4.65e-05  |g|= 0.00258  |ddm|= 0.014
  HOMO = 0.218781672287394  LUMO = 0.781407263162236
cycle= 25 E= -2393.50083645625  delta_E= -7.68e-05  |g|= 0.00238  |ddm|= 0.0235
  HOMO = 0.219067793362309  LUMO = 0.78142838123855
cycle= 26 E= -2393.50100028219  delta_E= -0.000164  |g|= 0.00233  |ddm|= 0.0551
  HOMO = 0.219000583129136  LUMO = 0.781426818357805
cycle= 27 E= -2393.5010180764  delta_E= -1.78e-05  |g|= 0.00228  |ddm|= 0.00671
  HOMO = 0.219352019072046  LUMO = 0.781445439666756
cycle= 28 E= -2393.50111226144  delta_E= -9.42e-05  |g|= 0.00218  |ddm|= 0.0365
  HOMO = 0.219202464717234  LUMO = 0.781453621163289
cycle= 29 E= -2393.50115250606  delta_E= -4.02e-05  |g|= 0.00201  |ddm|= 0.0161
  HOMO = 0.219137409672846  LUMO = 0.781492668367141
cycle= 30 E= -2393.50122855831  delta_E= -7.61e-05  |g|= 0.00188  |ddm|= 0.0317
  HOMO = 0.21917029866274  LUMO = 0.781504184660868
cycle= 31 E= -2393.50130194506  delta_E= -7.34e-05  |g|= 0.00187  |ddm|= 0.0336
  HOMO = 0.218840365681675  LUMO = 0.781517550046337
cycle= 32 E= -2393.50137828499  delta_E= -7.63e-05  |g|= 0.00199  |ddm|= 0.0349
  HOMO = 0.219243246271511  LUMO = 0.781529754041954
cycle= 33 E= -2393.50139119837  delta_E= -1.29e-05  |g|= 0.0018  |ddm|= 0.00829
  HOMO = 0.219298468755784  LUMO = 0.781545788854076
cycle= 34 E= -2393.50142166827  delta_E= -3.05e-05  |g|= 0.00175  |ddm|= 0.015
  HOMO = 0.219008674202404  LUMO = 0.78156908338248
cycle= 35 E= -2393.50151262679  delta_E= -9.1e-05  |g|= 0.00191  |ddm|= 0.044
  HOMO = 0.219257135314957  LUMO = 0.781599731764735
cycle= 36 E= -2393.50160341738  delta_E= -9.08e-05  |g|= 0.00222  |ddm|= 0.0512
  HOMO = 0.219284108926207  LUMO = 0.781604175163016
cycle= 37 E= -2393.50163166011  delta_E= -2.82e-05  |g|= 0.00185  |ddm|= 0.016
  HOMO = 0.219293208348326  LUMO = 0.781613574990889
cycle= 38 E= -2393.50166340842  delta_E= -3.17e-05  |g|= 0.00166  |ddm|= 0.0179
  HOMO = 0.219259462011825  LUMO = 0.781615421381291
cycle= 39 E= -2393.50169672354  delta_E= -3.33e-05  |g|= 0.00133  |ddm|= 0.0195
  HOMO = 0.2193032968933  LUMO = 0.781644417205584
cycle= 40 E= -2393.50177356176  delta_E= -7.68e-05  |g|= 0.00183  |ddm|= 0.0511
  HOMO = 0.219260708499849  LUMO = 0.781644698096761
cycle= 41 E= -2393.5018028727  delta_E= -2.93e-05  |g|= 0.00116  |ddm|= 0.0207
  HOMO = 0.219408858067018  LUMO = 0.781671935126541
cycle= 42 E= -2393.50186102176  delta_E= -5.81e-05  |g|= 0.0018  |ddm|= 0.0495
  HOMO = 0.219449253914485  LUMO = 0.781674466291035
cycle= 43 E= -2393.50188404501  delta_E= -2.3e-05  |g|= 0.00105  |ddm|= 0.0224
  HOMO = 0.219454954065175  LUMO = 0.781684424499063
cycle= 44 E= -2393.50190811429  delta_E= -2.41e-05  |g|= 0.000992  |ddm|= 0.0269
  HOMO = 0.21948909209912  LUMO = 0.781687879176668
cycle= 45 E= -2393.50191880917  delta_E= -1.07e-05  |g|= 0.000755  |ddm|= 0.0132
  HOMO = 0.219542550398747  LUMO = 0.781697247969382
cycle= 46 E= -2393.50192952825  delta_E= -1.07e-05  |g|= 0.000762  |ddm|= 0.0145
  HOMO = 0.219619631441267  LUMO = 0.781712008536574
cycle= 47 E= -2393.50194081157  delta_E= -1.13e-05  |g|= 0.00161  |ddm|= 0.0163
  HOMO = 0.219544599856465  LUMO = 0.781698808327958
cycle= 48 E= -2393.5019387949  delta_E= 2.02e-06  |g|= 0.000763  |ddm|= 0.00496
  HOMO = 0.219535327982335  LUMO = 0.781697554802578
cycle= 49 E= -2393.50193876136  delta_E= 3.35e-08  |g|= 0.00072  |ddm|= 0.000636
  HOMO = 0.219563336839308  LUMO = 0.781702508022398
cycle= 50 E= -2393.50194175564  delta_E= -2.99e-06  |g|= 0.000587  |ddm|= 0.00395
  HOMO = 0.219571809005322  LUMO = 0.781705371649328
cycle= 51 E= -2393.50194461621  delta_E= -2.86e-06  |g|= 0.000559  |ddm|= 0.00421
  HOMO = 0.219549779413764  LUMO = 0.781703870036612
cycle= 52 E= -2393.50194588635  delta_E= -1.27e-06  |g|= 0.000561  |ddm|= 0.00265
  HOMO = 0.219542190807582  LUMO = 0.781704761788326
cycle= 53 E= -2393.50194691371  delta_E= -1.03e-06  |g|= 0.000566  |ddm|= 0.00241
  HOMO = 0.219527002800108  LUMO = 0.78170432589439
cycle= 54 E= -2393.50194737958  delta_E= -4.66e-07  |g|= 0.000573  |ddm|= 0.00281
  HOMO = 0.219534444461451  LUMO = 0.781705359826255
cycle= 55 E= -2393.50194894221  delta_E= -1.56e-06  |g|= 0.000519  |ddm|= 0.00249
  HOMO = 0.21952894732348  LUMO = 0.78170430225985
cycle= 56 E= -2393.50195098585  delta_E= -2.04e-06  |g|= 0.000485  |ddm|= 0.00323
  HOMO = 0.219569209061594  LUMO = 0.781707233205786
cycle= 57 E= -2393.50195849516  delta_E= -7.51e-06  |g|= 0.000503  |ddm|= 0.0131
  HOMO = 0.219550884479512  LUMO = 0.781706310089219
cycle= 58 E= -2393.50195744241  delta_E= 1.05e-06  |g|= 0.000528  |ddm|= 0.00206
  HOMO = 0.21962935334466  LUMO = 0.781718062140344
cycle= 59 E= -2393.50196793091  delta_E= -1.05e-05  |g|= 0.000681  |ddm|= 0.0203
  HOMO = 0.219680829327606  LUMO = 0.781722772300249
cycle= 60 E= -2393.50197909676  delta_E= -1.12e-05  |g|= 0.00111  |ddm|= 0.0284
  HOMO = 0.219624840654475  LUMO = 0.781715339754756
cycle= 61 E= -2393.50197717414  delta_E= 1.92e-06  |g|= 0.000478  |ddm|= 0.00672
  HOMO = 0.219627232725529  LUMO = 0.781715440917353
cycle= 62 E= -2393.50197711622  delta_E= 5.79e-08  |g|= 0.000403  |ddm|= 0.000747
  HOMO = 0.219643068469256  LUMO = 0.781717028320295
cycle= 63 E= -2393.50197863066  delta_E= -1.51e-06  |g|= 0.000321  |ddm|= 0.00395
  HOMO = 0.219698645841439  LUMO = 0.781725429439623
cycle= 64 E= -2393.50198406085  delta_E= -5.43e-06  |g|= 0.000653  |ddm|= 0.0179
  HOMO = 0.219700571276941  LUMO = 0.781725743568222
cycle= 65 E= -2393.50198703874  delta_E= -2.98e-06  |g|= 0.000572  |ddm|= 0.0129
  HOMO = 0.219695976149085  LUMO = 0.781725940596182
cycle= 66 E= -2393.50198701727  delta_E= 2.15e-08  |g|= 0.000368  |ddm|= 0.00256
  HOMO = 0.219715173950556  LUMO = 0.781727771492751
cycle= 67 E= -2393.50198838954  delta_E= -1.37e-06  |g|= 0.000331  |ddm|= 0.00724
  HOMO = 0.219696330499939  LUMO = 0.781727249650579
cycle= 68 E= -2393.50198951436  delta_E= -1.12e-06  |g|= 0.00026  |ddm|= 0.00477
  HOMO = 0.219749826527586  LUMO = 0.781733083883985
cycle= 69 E= -2393.50199150531  delta_E= -1.99e-06  |g|= 0.000589  |ddm|= 0.0145
  HOMO = 0.21974608455195  LUMO = 0.781733088481932
cycle= 70 E= -2393.50199259192  delta_E= -1.09e-06  |g|= 0.00047  |ddm|= 0.00911
  HOMO = 0.219726529573726  LUMO = 0.78173088042335
cycle= 71 E= -2393.5019932372  delta_E= -6.45e-07  |g|= 0.000234  |ddm|= 0.00372
  HOMO = 0.219756500560917  LUMO = 0.781734919246439
cycle= 72 E= -2393.50199360861  delta_E= -3.71e-07  |g|= 0.000325  |ddm|= 0.00656
  HOMO = 0.219745779807127  LUMO = 0.781733181916431
cycle= 73 E= -2393.50199399519  delta_E= -3.87e-07  |g|= 0.000225  |ddm|= 0.00479
  HOMO = 0.219744113722241  LUMO = 0.781732893564256
cycle= 74 E= -2393.50199413237  delta_E= -1.37e-07  |g|= 0.000125  |ddm|= 0.00132
  HOMO = 0.219753077045258  LUMO = 0.781732675325868
cycle= 75 E= -2393.50199433251  delta_E= -2e-07  |g|= 0.000133  |ddm|= 0.00304
  HOMO = 0.219750740301216  LUMO = 0.781732148917864
cycle= 76 E= -2393.50199435885  delta_E= -2.63e-08  |g|= 0.000129  |ddm|= 0.00294
  HOMO = 0.219747762422267  LUMO = 0.781731979291652
cycle= 77 E= -2393.5019943611  delta_E= -2.25e-09  |g|= 7.06e-05  |ddm|= 0.000853
  HOMO = 0.21975427678802  LUMO = 0.781732436344087
cycle= 78 E= -2393.50199437286  delta_E= -1.18e-08  |g|= 2.78e-05  |ddm|= 0.000414
  HOMO = 0.219756081448612  LUMO = 0.781732401400881
cycle= 79 E= -2393.50199436797  delta_E= 4.89e-09  |g|= 3.33e-05  |ddm|= 0.000711
  HOMO = 0.219756172168273  LUMO = 0.781732213192246
cycle= 80 E= -2393.50199437401  delta_E= -6.03e-09  |g|= 1.93e-05  |ddm|= 0.000354
  HOMO = 0.219756935754768  LUMO = 0.781732189634689
cycle= 81 E= -2393.50199437314  delta_E= 8.72e-10  |g|= 1.83e-05  |ddm|= 0.000186
  HOMO = 0.119757509859647  LUMO = 0.581732267816748
Extra cycle  E= -2393.50199437394  delta_E= -8.02e-10  |g|= 1.6e-05  |ddm|= 4.69e-05
converged SCF energy = -2393.50199437394
Attempting SA-DMRGSCF with
40 states with spin multiplicity 2
10 states with spin multiplicity 4

******** <class 'pyscf.mcscf.addons.StateAverageCASSCF'> ********
CAS (5e+2e, 10o), ncore = 48, nvir = 40
max_cycle_macro = 50
max_cycle_micro = 4
conv_tol = 1e-07
conv_tol_grad = None
orbital rotation max_stepsize = 0.02
orbital rotation threshold for CI restart = 0.01
augmented hessian ah_max_cycle = 30
augmented hessian ah_conv_tol = 1e-12
augmented hessian ah_linear dependence = 1e-14
augmented hessian ah_level shift = 1e-08
augmented hessian ah_start_tol = 2.5
augmented hessian ah_start_cycle = 3
augmented hessian ah_grad_trust_region = 3
kf_trust_region = 3
kf_interval = 4
ci_response_space = 4
ci_grad_trust_region = 3
with_dep4 0
natorb = False
canonicalization = True
sorting_mo_energy = False
ao2mo_level = 2
chkfile = /home/Yxwxwx/code/dmet/test/large_1/tmp_63721/tmplf47fl79
max_memory 200000 MB (current use 105851 MB)
internal_rotation = False

******** Block flags ********
executable             = /home/Yxwxwx/.conda/envs/my_pyscf/bin/block2main
BLOCKEXE_COMPRESS_NEVPT= /path/to/serially/compiled/Block/block.spin_adapted
Block version          = 2.0
mpiprefix              =  
scratchDirectory       = /home/Yxwxwx/code/dmet/test/large_1/tmp_63721/1
integralFile           = /home/Yxwxwx/code/dmet/test/large_1/tmp_63721/1/FCIDUMP
configFile             = /home/Yxwxwx/code/dmet/test/large_1/tmp_63721/1/dmrg.conf
outputFile             = /home/Yxwxwx/code/dmet/test/large_1/tmp_63721/1/dmrg.out
maxIter                = 38
scheduleSweeps         = [0, 4, 8, 12, 14, 16, 18, 20, 22, 24, 26]
scheduleMaxMs          = [200, 400, 800, 1500, 1500, 1500, 1500, 1500, 1500, 1500, 1500]
scheduleTols           = [0.0001, 0.0001, 0.0001, 0.0001, 1e-05, 1.0000000000000002e-06, 1.0000000000000002e-07, 1.0000000000000002e-08, 1.0000000000000003e-09, 1.0000000000000003e-10, 1.0000000000000001e-11]
scheduleNoises         = [0.0001, 0.0001, 0.0001, 0.0001, 1e-05, 1.0000000000000002e-06, 1.0000000000000002e-07, 1.0000000000000002e-08, 1.0000000000000003e-09, 1.0000000000000003e-10, 0.0]
twodot_to_onedot       = 30
tol                    = 1e-10
maxM                   = 1500
dmrg switch tol        = 0.001
wfnsym                 = 1
fullrestart            = False
num_thrds              = 16
memory                 = 200

State-average over 50 states with weights [0.02 0.02 0.02 0.02 0.02 0.02 0.02 0.02 0.02 0.02 0.02 0.02 0.02 0.02
 0.02 0.02 0.02 0.02 0.02 0.02 0.02 0.02 0.02 0.02 0.02 0.02 0.02 0.02
 0.02 0.02 0.02 0.02 0.02 0.02 0.02 0.02 0.02 0.02 0.02 0.02 0.02 0.02
 0.02 0.02 0.02 0.02 0.02 0.02 0.02 0.02]
CASCI E = -2393.23789545754  S^2 = 1.3500000
Set conv_tol_grad to 0.000316228
macro iter   1 ( 21 JK    4 micro), CASSCF E = -2393.39123538113  dE = -1.53339924e-01  S^2 = 1.3500000
               |grad[o]|=0.354  |ddm|=0.00398  |maxRot[o]|= 0.27
macro iter   2 ( 21 JK    4 micro), CASSCF E = -2393.44812957967  dE = -5.68941985e-02  S^2 = 1.3500000
               |grad[o]|=0.166  |ddm|=0.0131  |maxRot[o]|=0.306
macro iter   3 ( 17 JK    4 micro), CASSCF E = -2393.46666767107  dE = -1.85380914e-02  S^2 = 1.3500000
               |grad[o]|=0.0468  |ddm|=0.0279  |maxRot[o]|=0.231
macro iter   4 (  9 JK    4 micro), CASSCF E = -2393.46670285549  dE = -3.51844183e-05  S^2 = 1.3500000
               |grad[o]|=0.00641  |ddm|=0.00191  |maxRot[o]|=0.0098
macro iter   5 (  5 JK    2 micro), CASSCF E = -2393.46670290011  dE = -4.46216291e-08  S^2 = 1.3500000
               |grad[o]|=0.000347  |ddm|=0.000122  |maxRot[o]|=0.000245
macro iter   6 (  3 JK    1 micro), CASSCF E = -2393.46670290267  dE = -2.55795385e-09  S^2 = 1.3500000
               |grad[o]|=9.47e-05  |ddm|=2.23e-05  |maxRot[o]|=3.5e-05
1-step CASSCF converged in   6 macro ( 76 JK  19 micro) steps
CASSCF canonicalization
Density matrix diagonal elements [1.39088297 1.39122954 1.39073808 1.39118047 1.39118449 0.00862967
 0.00929539 0.00878497 0.00886022 0.0092142 ]
CASSCF energy = -2393.46670290267
CASCI E = -2393.46670290267  E(CI) = -20.1631059469541  S^2 = 1.3500000
CASCI state-averaged energy = -2393.46670290267
CASCI energy for each state
  State 0 weight 0.02  E = -2393.51028468243 S^2 = 0.7500000
  State 1 weight 0.02  E = -2393.50978456539 S^2 = 0.7500000
  State 2 weight 0.02  E = -2393.50950154833 S^2 = 0.7500000
  State 3 weight 0.02  E = -2393.50926695721 S^2 = 0.7500000
  State 4 weight 0.02  E = -2393.50791896845 S^2 = 0.7500000
  State 5 weight 0.02  E = -2393.5071594151 S^2 = 0.7500000
  State 6 weight 0.02  E = -2393.50381950273 S^2 = 0.7500000
  State 7 weight 0.02  E = -2393.49587064428 S^2 = 0.7500000
  State 8 weight 0.02  E = -2393.49542437744 S^2 = 0.7500000
  State 9 weight 0.02  E = -2393.48849840553 S^2 = 0.7500000
  State 10 weight 0.02  E = -2393.48249542477 S^2 = 0.7500000
  State 11 weight 0.02  E = -2393.48133555267 S^2 = 0.7500000
  State 12 weight 0.02  E = -2393.48049196955 S^2 = 0.7500000
  State 13 weight 0.02  E = -2393.48022323791 S^2 = 0.7500000
  State 14 weight 0.02  E = -2393.47968712705 S^2 = 0.7500000
  State 15 weight 0.02  E = -2393.47939208325 S^2 = 0.7500000
  State 16 weight 0.02  E = -2393.47142333637 S^2 = 0.7500000
  State 17 weight 0.02  E = -2393.47028711184 S^2 = 0.7500000
  State 18 weight 0.02  E = -2393.47016629804 S^2 = 0.7500000
  State 19 weight 0.02  E = -2393.46851339646 S^2 = 0.7500000
  State 20 weight 0.02  E = -2393.46775872093 S^2 = 0.7500000
  State 21 weight 0.02  E = -2393.46564177186 S^2 = 0.7500000
  State 22 weight 0.02  E = -2393.46328100378 S^2 = 0.7500000
  State 23 weight 0.02  E = -2393.46228087148 S^2 = 0.7500000
  State 24 weight 0.02  E = -2393.45886554319 S^2 = 0.7500000
  State 25 weight 0.02  E = -2393.455628809 S^2 = 0.7500000
  State 26 weight 0.02  E = -2393.45052405916 S^2 = 0.7500000
  State 27 weight 0.02  E = -2393.44787890928 S^2 = 0.7500000
  State 28 weight 0.02  E = -2393.40608486638 S^2 = 0.7500000
  State 29 weight 0.02  E = -2393.40394648136 S^2 = 0.7500000
  State 30 weight 0.02  E = -2393.40141252802 S^2 = 0.7500000
  State 31 weight 0.02  E = -2393.4005780567 S^2 = 0.7500000
  State 32 weight 0.02  E = -2393.39872097619 S^2 = 0.7500000
  State 33 weight 0.02  E = -2393.39820069464 S^2 = 0.7500000
  State 34 weight 0.02  E = -2393.39552233886 S^2 = 0.7500000
  State 35 weight 0.02  E = -2393.30568837548 S^2 = 0.7500000
  State 36 weight 0.02  E = -2393.30298556305 S^2 = 0.7500000
  State 37 weight 0.02  E = -2393.2996819882 S^2 = 0.7500000
  State 38 weight 0.02  E = -2393.29861438492 S^2 = 0.7500000
  State 39 weight 0.02  E = -2393.29528722142 S^2 = 0.7500000
  State 40 weight 0.02  E = -2393.59586636858 S^2 = 3.7500000
  State 41 weight 0.02  E = -2393.59108546541 S^2 = 3.7500000
  State 42 weight 0.02  E = -2393.57782836863 S^2 = 3.7500000
  State 43 weight 0.02  E = -2393.57358042568 S^2 = 3.7500000
  State 44 weight 0.02  E = -2393.57020873474 S^2 = 3.7500000
  State 45 weight 0.02  E = -2393.5691723914 S^2 = 3.7500000
  State 46 weight 0.02  E = -2393.5643944446 S^2 = 3.7500000
  State 47 weight 0.02  E = -2393.50758991231 S^2 = 3.7500000
  State 48 weight 0.02  E = -2393.50319846032 S^2 = 3.7500000
  State 49 weight 0.02  E = -2393.50209279312 S^2 = 3.7500000
Initializing 4c-HF with Gaunt with gauge for C atom.
Maximum memory cost (2e part) in SCF and amfi calculation: 0.00321078 GB.
1e-integrals time (CPU/WALL): 0.00/0.00 seconds.
2e-Coulomb-integrals time (CPU/WALL): 0.26/0.02 seconds.
2e-Gaunt-integrals time (CPU/WALL): 0.25/0.01 seconds.
2e-gauge-integrals time (CPU/WALL): 0.96/0.06 seconds.

Start Dirac Hartree-Fock iterations...
with SCF convergence = 1e-09


SCF converges after 10 iterations.

Final DHF energy is -37.3324964757747 hartree.
DHF iterations time (CPU/WALL): 0.07/0.01 seconds.
2e-SO Coulomb integrals time (CPU/WALL): 0.15/0.03 seconds.
Initializing 4c-HF with Gaunt with gauge for CO atom.
Maximum memory cost (2e part) in SCF and amfi calculation: 0.0711967349052429 GB.
1e-integrals time (CPU/WALL): 0.00/0.00 seconds.
2e-Coulomb-integrals time (CPU/WALL): 0.38/0.38 seconds.
2e-Gaunt-integrals time (CPU/WALL): 0.26/0.26 seconds.
2e-gauge-integrals time (CPU/WALL): 1.40/1.40 seconds.

Start Dirac Hartree-Fock iterations...
with SCF convergence = 1e-09


SCF converges after 18 iterations.

Final DHF energy is -1390.51515626882 hartree.
DHF iterations time (CPU/WALL): 0.09/0.09 seconds.
2e-SO Coulomb integrals time (CPU/WALL): 0.53/0.53 seconds.
Initializing 4c-HF with Gaunt with gauge for S atom.
Maximum memory cost (2e part) in SCF and amfi calculation: 0.0255496501922607 GB.
1e-integrals time (CPU/WALL): 0.00/0.00 seconds.
2e-Coulomb-integrals time (CPU/WALL): 0.13/0.13 seconds.
2e-Gaunt-integrals time (CPU/WALL): 0.09/0.09 seconds.
2e-gauge-integrals time (CPU/WALL): 0.47/0.47 seconds.

Start Dirac Hartree-Fock iterations...
with SCF convergence = 1e-09


SCF converges after 13 iterations.

Final DHF energy is -398.221567213695 hartree.
DHF iterations time (CPU/WALL): 0.02/0.02 seconds.
2e-SO Coulomb integrals time (CPU/WALL): 0.18/0.18 seconds.
Initializing 4c-HF with Gaunt with gauge for H atom.
Maximum memory cost (2e part) in SCF and amfi calculation: 4.57763671875e-05 GB.
1e-integrals time (CPU/WALL): 0.00/0.00 seconds.
2e-Coulomb-integrals time (CPU/WALL): 0.00/0.00 seconds.
2e-Gaunt-integrals time (CPU/WALL): 0.00/0.00 seconds.
2e-gauge-integrals time (CPU/WALL): 0.00/0.00 seconds.

Start Dirac Hartree-Fock iterations...
with SCF convergence = 1e-09

Special treatment for fractional occupation of H atom.

SCF converges after 1 iterations.

Final DHF energy is -0.340081496312782 hartree.
DHF iterations time (CPU/WALL): 0.00/0.00 seconds.
2e-SO Coulomb integrals time (CPU/WALL): 0.00/0.00 seconds.
mo_cas.shape =  (569, 10)
sodm1.shape =  (569, 569)
xdmao.shape =  (1072, 1072)
hso1e.shape =  (3, 569, 569)
hso2e.shape =  (3, 569, 569)
hso.shape =  (3, 10, 10)
