[DEBUG] 临时目录已设置为：/home/Yxwxwx/code/dmet/test/Cr2/tmp_64298
#INFO: **** input file is /home/Yxwxwx/code/dmet/test/Cr2/dmet_siso.py ****
from pyscf import gto, scf, ao2mo, mcscf, fci, dmrgscf, lib

# from pyscf.csf_fci import csf_solver  # TODO:
from pyscf.mcscf import avas
from pyscf.tools import molden, fcidump
from pyscf.lib import logger, cho_solve
from pyscf.data import nist
import numpy as np
import scipy
from functools import reduce
import os
import tempfile
from liblan.utils.rdiis import tag_rdiis_
from mycamf import x2camf
from time import time

dmrgscf.settings.BLOCKEXE = os.popen("which block2main").read().strip()
dmrgscf.settings.MPIPREFIX = " "


def set_custom_tmpdir(workdir):
    # 动态获取Slurm分配的作业ID（当在Slurm环境下运行时）
    slurm_job_id = os.getenv("SLURM_JOB_ID", "localrun")

    # 构建唯一临时目录路径
    custom_tmp = os.path.abspath(os.path.join(workdir, f"tmp_{slurm_job_id}"))

    # 确保目录存在
    os.makedirs(custom_tmp, exist_ok=True)

    # 双重配置方案：修改PySCF参数 + 重定向环境变量
    lib.param.TMPDIR = custom_tmp
    os.environ["TMPDIR"] = custom_tmp  # 覆盖系统环境变量
    tempfile.tempdir = custom_tmp  # 影响Python标准库的临时文件

    print(f"[DEBUG] 临时目录已设置为：{custom_tmp}")


current_workdir = os.path.dirname(os.path.abspath(__file__))
set_custom_tmpdir(current_workdir)


def read_cas_info(fname):
    with open(fname, "r") as f1:
        ncasorb, ncaselec = [int(x) for x in f1.readline().split(" ")]
        casorbind = [int(x) for x in f1.readline().split(" ")]
        statelis = [int(x) for x in f1.readline().split(" ")]
    return ncasorb, ncaselec, casorbind, statelis


def rohf_solve_imp(hcore, eris, nelec, spin, max_mem, dm0=None, verbose=logger.INFO):
    mol = gto.M()
    mol.verbose = verbose
    mol.incore_anyway = True
    mol.nelectron = nelec
    mol.spin = spin

    nao = hcore.shape[0]
    print("nao = ", nao)
    print("nelec = ", mol.nelec)

    mf = scf.rohf.ROHF(mol).x2c()
    mf.max_memory = max_mem
    mf.mo_energy = np.zeros((nao))
    mf.max_cycle = 1000
    mf.diis_space = 8
    mf.init_guess = "1e"
    mf.level_shift = 0.2

    mf.get_hcore = lambda *args: hcore
    mf.get_ovlp = lambda *args: np.eye(nao)
    mf._eri = ao2mo.restore(8, eris, nao)

    if dm0 is None:
        mf.kernel()
    else:
        if dm0.shape != hcore.shape:
            bath_size = hcore.shape[0] - dm0.shape[0]
            dm0 = scipy.linalg.block_diag(
                dm0, np.eye(bath_size) * (nelec - np.trace(dm0)) / bath_size
            )
        mf.kernel(dm0)
    return mf


def sacasscf_solve_imp(
    solver_base, mol, ncasorb, ncaselec, casorbind, statelis, avas=False
):
    solver = mcscf.CASSCF(solver_base, ncasorb, ncaselec)

    if avas:
        mo = casorbind
    else:
        mo = solver.sort_mo(casorbind)
    mcfs = []
    logger.info(solver, "Attempting SA-DMRGSCF with")
    for i in range(len(statelis)):
        if statelis[i] != 0:
            new_mcf = dmrgscf.DMRGCI(mol, maxM=1500, tol=1e-10)
            new_mcf.spin = i
            new_mcf.nroots = statelis[i]
            new_mcf.threads = 32
            new_mcf.memory = int(mol.max_memory / 1000)
            new_mcf.block_extra_keyword = [
                "real_density_matrix",
                "davidson_soft_max_iter 1600",
                "noreorder",
                "cutoff 1E-24",
            ]
            new_mcf.runtimeDir = lib.param.TMPDIR + "/%d" % i
            new_mcf.scratchDirectory = lib.param.TMPDIR + "/%d" % i
            mcfs.append(new_mcf)
            logger.info(
                solver, "%s states with spin multiplicity %s", statelis[i], i + 1
            )

    statetot = sum(statelis)
    mcscf.state_average_mix_(solver, mcfs, np.ones(statetot) / statetot)
    solver.run(mo, verbose=mol.verbose)
    return solver


def lowdin(s):
    """new basis is |mu> c^{lowdin}_{mu i}"""
    e, v = scipy.linalg.eigh(s)
    idx = e > 1e-15
    return np.dot(v[:, idx] / np.sqrt(e[idx]), v[:, idx].conj().T)


def caolo(s):
    return lowdin(s)


def cloao(s):
    return lowdin(s) @ s


def get_dmet_as_props(mf, imp_inds, lo_meth="lowdin", thres=1e-13):
    """
    Returns C(AO->AS), entropy loss, and orbital composition
    """
    s = mf.get_ovlp()
    caolo_mat, cloao_mat = caolo(s), cloao(s)
    env_inds = [x for x in range(s.shape[0]) if x not in imp_inds]

    if mf.mol.spin == 0:
        pass
    else:
        dma, dmb = mf.make_rdm1()

        ldma = reduce(np.dot, (cloao_mat, dma, cloao_mat.conj().T))
        ldmb = reduce(np.dot, (cloao_mat, dmb, cloao_mat.conj().T))

        ldma_env = ldma[env_inds, :][:, env_inds]
        ldmb_env = ldmb[env_inds, :][:, env_inds]

        nat_occa, nat_coeffa = np.linalg.eigh(ldma_env)
        nat_occb, nat_coeffb = np.linalg.eigh(ldmb_env)

        ldmr_env = ldma_env + ldmb_env
        nat_occr, nat_coeffr = np.linalg.eigh(ldmr_env)

        caoas = np.hstack([caolo_mat[:, imp_inds], caolo_mat[:, env_inds] @ nat_coeffr])

        nuu = np.sum([nat_occr < thres])
        ne = np.sum([(nat_occr >= thres) & (nat_occr <= 2 - thres)])
        nuo = np.sum([nat_occr > 2 - thres])

        asorbs = (nuu, ne, nuo)
        print("caoas.shape = ", caoas.shape)
        print("asorbs = ", asorbs)

        nat_occa = nat_occa[nat_occa > thres]
        nat_occb = nat_occb[nat_occb > thres]
        nat_occr = nat_occr[nat_occr > thres]

        ent = -np.sum(nat_occa * np.log(nat_occa)) - np.sum(nat_occb * np.log(nat_occb))
        entr = -2 * np.sum(nat_occr / 2 * np.log(nat_occr / 2))

        return caoas, entr - ent, asorbs


def get_dmet_imp_ldm(mf, imp_inds, lo_meth="lowdin"):
    """
    Returns better initial guess than '1e' for impurity
    """
    s = mf.get_ovlp()
    caolo_mat, cloao_mat = caolo(s), cloao(s)

    dma, dmb = mf.make_rdm1()

    ldm = reduce(np.dot, (cloao_mat, (dma + dmb), cloao_mat.conj().T))[imp_inds, :][
        :, imp_inds
    ]
    return ldm


def get_as_1e_ints(mf, caoas, asorbs):
    # hcore from mf
    hcore = mf.get_hcore()

    # HF J/K from env UO
    uos = hcore.shape[0] - asorbs[-1]
    dm_uo = caoas[:, uos:] @ caoas[:, uos:].conj().T * 2
    vj, vk = mf.get_jk(dm=dm_uo)

    fock = hcore + vj - 0.5 * vk

    nimp = hcore.shape[0] - np.sum(asorbs)
    act_inds = [
        *list(range(nimp)),
        *list(range(nimp + asorbs[0], nimp + asorbs[0] + asorbs[1])),
    ]

    asints1e = reduce(np.dot, (caoas[:, act_inds].conj().T, fock, caoas[:, act_inds]))
    return asints1e


def get_as_2e_ints(mf, caoas, asorbs):
    nimp = caoas.shape[0] - np.sum(asorbs)
    act_inds = [
        *list(range(nimp)),
        *list(range(nimp + asorbs[0], nimp + asorbs[0] + asorbs[1])),
    ]

    if mf._eri is not None:
        asints2e = ao2mo.full(mf._eri, caoas[:, act_inds])
    else:
        asints2e = ao2mo.full(mf.mol, caoas[:, act_inds])

    return asints2e


def get_bp_hso2e(mol, dm0):
    hso2e = mol.intor("int2e_p1vxp1", 3).reshape(3, mol.nao, mol.nao, mol.nao, mol.nao)
    vj = np.einsum("yijkl,lk->yij", hso2e, dm0, optimize=True)
    vk = np.einsum("yijkl,jk->yil", hso2e, dm0, optimize=True)
    vk += np.einsum("yijkl,li->ykj", hso2e, dm0, optimize=True)
    return vj, vk


def get_bp_hso2e_amfi(mol, dm0):
    """atomic-mean-field approximation"""
    ao_loc = mol.ao_loc_nr()
    nao = ao_loc[-1]
    vj = np.zeros((3, nao, nao))
    vk = np.zeros((3, nao, nao))
    import copy

    atom = copy.copy(mol)
    aoslice = mol.aoslice_by_atom(ao_loc)
    for ia in range(mol.natm):
        b0, b1, p0, p1 = aoslice[ia]
        atom._bas = mol._bas[b0:b1]
        vj1, vk1 = get_bp_hso2e(atom, dm0[p0:p1, p0:p1])
        vj[:, p0:p1, p0:p1] = vj1
        vk[:, p0:p1, p0:p1] = vk1
    return vj, vk


start = time()

mol = gto.M(
    atom="""
  Cr  -1.35424450239280      0.00748246778796     -0.00087595645706 
  Cr   1.35423764131845      0.00747803055009     -0.00087750355078 
  O   -0.00000294430974     -0.13734660180713      1.46342333077295 
  O   -0.00000064383679      1.35420350893235     -0.59959802230353 
  O   -0.00000516089286     -1.18217624605433     -0.86562559483160 
  H   -0.00000065463206      0.52075486357441      2.16950923336362 
  H    0.00000446473449      1.64878725909317     -1.51878718478551 
  H   -0.00000926896581     -2.12530440890393     -0.66035454411104 
  N   -2.68346617865321     -1.45853826988486      0.70650005032200 
  C   -2.01822727274717     -2.52465540625361      1.50592497177303 
  C   -3.25911308583331     -2.04955652529081     -0.54278797058362 
  C   -3.74827281074952     -0.80152247456954      1.54881850901734 
  H   -1.56748557922213     -2.08271923805020      2.39129571316802 
  H   -1.24243826043958     -2.99862043316970      0.90648770606852 
  H   -2.74840997387176     -3.28356694917433      1.79607780436372 
  H   -2.46291984415168     -2.62337513441757     -1.02093781896581 
  H   -4.07044743926176     -2.74311239041734     -0.30244269679464 
  H   -4.65448299937734     -0.70680487372819      0.95372217138132 
  H   -3.99500774926338     -1.44490669699879      2.39456976728496 
  N   -2.69755450329625      1.34136962911627      0.91026422821942 
  N   -2.69230526823111      0.11718842081111     -1.61665366474216 
  C   -3.74849616889413     -0.94865197019848     -1.46353644818261 
  C   -3.27063403754831      0.54952804549553      2.04434124343513 
  N    2.68346715675698     -1.45854069314242      0.70650003406182 
  N    2.69754925024949      1.34136611134027      0.91026654207433 
  N    2.69230403104748      0.11718547928447     -1.61665262689138 
  C   -2.04437616396754      2.57225987860668      1.43663608392829 
  C   -3.76194284730143      1.73300596201565     -0.08408294061084 
  C   -2.03228717940052     -0.03618283988186     -2.94309134997238 
  C   -3.27725483448617      1.49033558111027     -1.50018850579138 
  H   -4.65645471974087     -0.48734410738601     -1.07991760798513 
  H   -3.99664215151405     -1.36168809799084     -2.44226987052617 
  H   -2.47549715669751      0.42734931293811      2.78234874695929
  H   -4.08755174458298      1.09782217898898      2.52290059499979 
  C    2.01823189480386     -2.52466013170271      1.50592432110894 
  C    3.25911692194754     -2.04955805616288     -0.54278693277931 
  C    3.74827350165531     -0.80152393465555      1.54881874867098 
  C    2.04437438874437      2.57225673960399      1.43664047370217 
  C    3.27063260709400      0.54952529364165      2.04434238389264 
  C    3.76193758070494      1.73300459398023     -0.08408076294943 
  C    2.03228955044192     -0.03618719210796     -2.94309210428304 
  C    3.27724995734855      1.49033424715459     -1.50018655506513 
  C    3.74849826690828     -0.94865216224951     -1.46353430216360 
  H   -1.59575047514265      3.12234814848417      0.61291937461478 
  H   -1.26826445350661      2.29664085726858      2.14911186944439 
  H   -2.78162146845096      3.19639860592609      1.94666596437982 
  H   -4.66409353100933      1.16248658840109      0.12799867351868 
  H   -4.01827672254151      2.78498397644774      0.04889460213876 
  H   -1.57918667365396     -1.02245710553356     -3.00817218975222 
  H   -1.25884477264019      0.72228568282228     -3.05436504943444 
  H   -2.76640836866444      0.09214024180044     -3.74175962042542 
  H   -2.48702512015610      2.19699107950093     -1.76109217570029 
  H   -4.09281437247312      1.62358792037224     -2.21722220410103 
  H    1.56748953447666     -2.08272559171093      2.39129530400812 
  H    1.24244410784823     -2.99862712397942      0.90648689200259 
  H    2.74841706997603     -3.28356963121360      1.79607623870542 
  H    2.46292569126273     -2.62337849835601     -1.02093792725634 
  H    4.07045302720973     -2.74311163538248     -0.30244048876426 
  H    4.65448346115229     -0.70680401028077      0.95372228032966 
  H    3.99501075900995     -1.44490851377397      2.39456915731191 
  H    1.59574566134859      3.12234477429960      0.61292534612400 
  H    1.26826627874473      2.29663922181641      2.14912084106002 
  H    2.78162298309563      3.19639495340303      1.94666639317082 
  H    2.47549786087627      0.42734489313183      2.78235173581885 
  H    4.08755032211489      1.09782125435258      2.52289983946985 
  H    4.66408898713428      1.16248602569396      0.12799994420443 
  H    4.01827034865908      2.78498276510688      0.04889794787615 
  H    1.57919077794174     -1.02246221135116     -3.00817477609090 
  H    1.25884680990156      0.72228058908288     -3.05436842804018 
  H    2.76641276635084      0.09213636615134     -3.74175868249209 
  H    2.48701845128170      2.19698799301717     -1.76108932637069 
  H    4.09280944357511      1.62358920085783     -2.21721985740965 
  H    4.65645441062758     -0.48734137231740     -1.07991321549768 
  H    3.99664791915730     -1.36168656486501     -2.44226768508526 
        """,
    basis={
        "default": "def2tzvp",
        "C": "6-31G*",
        "H": "6-31G*",
        "N": "6-31G*",
    },
    symmetry=0,
    spin=6,
    charge=+3,
    verbose=4,
    max_memory=200000,
)

mf = scf.rohf.ROHF(mol).x2c()
mf.max_cycle = 100
title = "Cr2O4"
imp_inds = mol.search_ao_label(["Cr *", "O *"])
mf.chkfile = title + "_rohf.chk"
mf.init_guess = "atom"
mf.level_shift = 0.2
if os.path.isfile(title + "_rohf.chk"):
    mf.init_guess = "chk"
    mf.level_shift = 0.0
mf = tag_rdiis_(mf=mf, imp_inds=imp_inds)
mf.kernel()

print("nao = ", mol.nao_nr())
print("nelec = ", mol.nelec)


print("imp_inds.shape", imp_inds.shape)

# AS general info
caoas, ent, asorbs = get_dmet_as_props(mf, imp_inds, thres=1e-13)
# AS hcore + j/k
as1e = get_as_1e_ints(mf, caoas, asorbs)
# AS ERIs
as2e = get_as_2e_ints(mf, caoas, asorbs)

print(f"Entanglement S: {ent:.3f}")

nimp = caoas.shape[0] - np.sum(asorbs)
print("nimp = ", nimp)
act_inds = [
    *list(range(nimp)),
    *list(range(nimp + asorbs[0], nimp + asorbs[0] + asorbs[1])),
]

print("act_inds = ", act_inds)

nelec = int(mf.mol.nelectron - asorbs[-1] * 2)
ldm = get_dmet_imp_ldm(mf, imp_inds)
solver_base = rohf_solve_imp(as1e, as2e, nelec, mf.mol.spin, mf.max_memory, dm0=ldm)

with open(title + "_imp_rohf_orbs.molden", "w") as f1:
    molden.header(mf.mol, f1)
    molden.orbital_coeff(
        mf.mol,
        f1,
        caoas[:, act_inds] @ solver_base.mo_coeff,
        ene=solver_base.mo_energy,
        occ=solver_base.mo_occ,
    )

# avas
# ao_labels = ["Co 3d"]
# ncasorb, ncaselec, casorbind = avas.avas(solver_base, ao_labels, canonicalize=False)

# ncasorb = 5
# ncaselec = 7
# casorbind = [40, 41, 55, 56, 57]  # F-style

casinfo_fname = title + "_cas_info"


if not os.path.isfile(casinfo_fname):
    print("Failed to read saved CAS briefings.")
    exit()


ncasorb, ncaselec, casorbind, statelis = read_cas_info(casinfo_fname)

solver = sacasscf_solve_imp(
    solver_base, mf.mol, ncasorb, ncaselec, casorbind, statelis=statelis
)

mc = solver.copy()
fcidump.from_integrals(
    "FCIDUMP",
    solver.get_h1eff()[0],
    solver.get_h2eff(),
    solver.ncas,
    solver.nelecas,
    nuc=solver.get_h1eff()[1],
)

# dm = solver.make_rdm1()
# print("dm.shape = ", dm.shape)

# casinfo_fname_large = title + "_cas_info_large"

# if not os.path.isfile(casinfo_fname_large):
#     print("Failed to read saved Large CAS briefings.")
#     exit()
# ncasorb_large, ncaselec_large, casorbind_large, statelis_large = read_cas_info(
#     casinfo_fname
# )
# solver.ncas = ncasorb_large
# solver.nelecas = ncaselec_large
# solver.mo_coeff = solver.sort_mo(casorbind_large, solver.mo_coeff)
# fcidump.from_integrals(
#     "FCIDUMP_1",
#     solver.get_h1eff()[0],
#     solver.get_h2eff(),
#     solver.ncas,
#     solver.nelecas,
#     nuc=mc.get_h1eff()[1],
# )

# with open("cas.molden", "w") as f1:
#     molden.header(mol, f1)
#     molden.orbital_coeff(
#         mol,
#         f1,
#         caoas[:, act_inds] @ solver.mo_coeff,
#         ene=solver_base.mo_energy,
#         occ=solver_base.mo_occ,
#     )


uos = caoas.shape[0] - asorbs[-1]
dm_uo = caoas[:, uos:] @ caoas[:, uos:].conj().T * 2
mo_cas = caoas[:, act_inds] @ mc.mo_coeff[:, mc.ncore : mc.ncore + mc.ncas]
print("mo_cas.shape = ", mo_cas.shape)
sodm1_act = reduce(
    np.dot, [caoas[:, act_inds], mc.make_rdm1(), caoas[:, act_inds].conj().T]
)
sodm1 = sodm1_act + dm_uo

# soc integral
# breit-pauli amfi
# amfi = True
# hso1e = mol.intor_asymmetric("int1e_pnucxp", 3)
# vj, vk = get_bp_hso2e_amfi(mol, sodm1) if amfi else get_bp_hso2e(mol, sodm1)
# hso2e = vj - vk * 1.5
# hsoao = 1.0j * (nist.ALPHA**2 / 2) * (hso1e + hso2e)
# print("hsoao.shape = ", hsoao.shape)

# hso = np.asarray([reduce(np.dot, (mo_cas.T, x.T, mo_cas)) for x in hsoao])
# print("hso.shape = ", hso.shape)
# # Save each component of hso (shape: 3 x nao x nao) to separate binary files as complex128
# hso[0].astype(np.complex128).tofile("hso_x.bin")
# hso[1].astype(np.complex128).tofile("hso_y.bin")
# hso[2].astype(np.complex128).tofile("hso_z.bin")

# x2camf

xmol, ctr = mf.with_x2c.get_xmol(mol)
xdmao = ctr @ sodm1 @ ctr.conj().T
print("sodm1.shape = ", sodm1.shape)
print("xdmao.shape = ", xdmao.shape)
x = mf.with_x2c.get_xmat()
r = mf.with_x2c._get_rmat(x=x)
hso1e = xmol.intor_asymmetric("int1e_pnucxp", 3)
hso1e = np.einsum(
    "pq,qr,irs,sk,kl->ipl", r.conj().T, x.conj().T, hso1e, x, r, optimize=True
)

hso2e = x2camf.amfi(mf.with_x2c, printLevel=1)

hso2e = hso2e / (nist.ALPHA**2 / 4)
sphsp = xmol.sph2spinor_coeff()
p_repr = np.einsum("ixp,pq,jyq->ijxy", sphsp, hso2e, sphsp.conj(), optimize=True)
hso2e = (p_repr[0, np.array([1, 1, 0])] * np.array([-1j, 1, -1j])[:, None, None]).real

s22 = xmol.intor_symmetric("int1e_ovlp")
s21 = gto.intor_cross("int1e_ovlp", xmol, mol)
c = cho_solve(s22, s21)
hso1e = c.conj().T @ hso1e @ c
hso2e = c.conj().T @ hso2e @ c
print("hso1e.shape = ", hso1e.shape)
print("hso2e.shape = ", hso2e.shape)
hsoao = (1j * nist.ALPHA**2 / 2) * (hso1e + hso2e)

hso = np.asarray([reduce(np.dot, (mo_cas.T.conj(), i.T, mo_cas)) for i in hsoao])
print("hso.shape = ", hso.shape)
# Save each component of hso (shape: 3 x nao x nao) to separate binary files as complex128
hso_labels = ["x", "y", "z"]
for i, label in enumerate(hso_labels):
    with open(f"hso_{label}.bin", "wb") as f:
        # 先写入shape信息（int32），再写入数据（complex128）
        shape = np.array(hso[i].shape, dtype=np.int32)
        f.write(shape.tobytes())
        f.write(hso[i].astype(np.complex128).tobytes())
        # print(hso[i])

print(f"total time elapsed: {time() - start:.2f}s")
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cu01', release='5.15.0-126-generic', version='#136-Ubuntu SMP Wed Nov 6 10:38:22 UTC 2024', machine='x86_64')  Threads 32
Python 3.13.2 | packaged by Anaconda, Inc. | (main, Feb  6 2025, 18:56:02) [GCC 11.2.0]
numpy 2.2.6  scipy 1.15.3  h5py 3.13.0
Date: Wed Jul  2 21:17:57 2025
PySCF version 2.9.0
PySCF path  /home/Yxwxwx/.conda/envs/my_pyscf/lib/python3.13/site-packages/pyscf

[CONFIG] conf_file None
[INPUT] verbose = 4
[INPUT] num. atoms = 74
[INPUT] num. electrons = 264
[INPUT] charge = 3
[INPUT] spin (= nelec alpha-beta = 2S) = 6
[INPUT] symmetry 0 subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Cr    -1.354244502393   0.007482467788  -0.000875956457 AA   -2.559151215220   0.014139814855  -0.001655317801 Bohr   0.0
[INPUT]  2 Cr     1.354237641318   0.007478030550  -0.000877503551 AA    2.559138249669   0.014131429691  -0.001658241384 Bohr   0.0
[INPUT]  3 O     -0.000002944310  -0.137346601807   1.463423330773 AA   -0.000005563939  -0.259547461555   2.765469299460 Bohr   0.0
[INPUT]  4 O     -0.000000643837   1.354203508932  -0.599598022304 AA   -0.000001216675   2.559073748807  -1.133076046985 Bohr   0.0
[INPUT]  5 O     -0.000005160893  -1.182176246054  -0.865625594832 AA   -0.000009752674  -2.233989336009  -1.635795300645 Bohr   0.0
[INPUT]  6 H     -0.000000654632   0.520754863574   2.169509233364 AA   -0.000001237075   0.984084070191   4.099778275772 Bohr   0.0
[INPUT]  7 H      0.000004464734   1.648787259093  -1.518787184786 AA    0.000008437125   3.115756357358  -2.870091820744 Bohr   0.0
[INPUT]  8 H     -0.000009268966  -2.125304408904  -0.660354544111 AA   -0.000017515807  -4.016243264159  -1.247889233482 Bohr   0.0
[INPUT]  9 N     -2.683466178653  -1.458538269885   0.706500050322 AA   -5.071016142188  -2.756237872279   1.335091602100 Bohr   0.0
[INPUT] 10 C     -2.018227272747  -2.524655406254   1.505924971773 AA   -3.813896802620  -4.770907276722   2.845785760794 Bohr   0.0
[INPUT] 11 C     -3.259113085833  -2.049556525291  -0.542787970584 AA   -6.158831141211  -3.873100509615  -1.025720608112 Bohr   0.0
[INPUT] 12 C     -3.748272810750  -0.801522474570   1.548818509017 AA   -7.083209052470  -1.514657959620   2.926842798700 Bohr   0.0
[INPUT] 13 H     -1.567485579222  -2.082719238050   2.391295713168 AA   -2.962118448935  -3.935768954278   4.518893980734 Bohr   0.0
[INPUT] 14 H     -1.242438260440  -2.998620433170   0.906487706069 AA   -2.347868038912  -5.666571370215   1.713013499755 Bohr   0.0
[INPUT] 15 H     -2.748409973872  -3.283566949174   1.796077804364 AA   -5.193742128641  -6.205042245613   3.394095148658 Bohr   0.0
[INPUT] 16 H     -2.462919844152  -2.623375134418  -1.020937818966 AA   -4.654243972203  -4.957460526043  -1.929292868056 Bohr   0.0
[INPUT] 17 H     -4.070447439262  -2.743112390417  -0.302442696795 AA   -7.692030864642  -5.183731146790  -0.571533865317 Bohr   0.0
[INPUT] 18 H     -4.654482999377  -0.706804873728   0.953722171381 AA   -8.795698120267  -1.335667634854   1.802273702836 Bohr   0.0
[INPUT] 19 H     -3.995007749263  -1.444906696999   2.394569767285 AA   -7.549470511623  -2.730477932878   4.525081046332 Bohr   0.0
[INPUT] 20 N     -2.697554503296   1.341369629116   0.910264228219 AA   -5.097639217317   2.534821230839   1.720150092323 Bohr   0.0
[INPUT] 21 N     -2.692305268231   0.117188420811  -1.616653664742 AA   -5.087719600680   0.221454020303  -3.055032664637 Bohr   0.0
[INPUT] 22 C     -3.748496168894  -0.948651970198  -1.463536448183 AA   -7.083631138191  -1.792692411204  -2.765683060384 Bohr   0.0
[INPUT] 23 C     -3.270634037548   0.549528045496   2.044341243435 AA   -6.180602584647   1.038457503754   3.863245055245 Bohr   0.0
[INPUT] 24 N      2.683467156757  -1.458540693142   0.706500034062 AA    5.071017990536  -2.756242451572   1.335091571373 Bohr   0.0
[INPUT] 25 N      2.697549250249   1.341366111340   0.910266542074 AA    5.097629290497   2.534814583206   1.720154464875 Bohr   0.0
[INPUT] 26 N      2.692304031047   0.117185479284  -1.616652626891 AA    5.087717262742   0.221448461624  -3.055030703383 Bohr   0.0
[INPUT] 27 C     -2.044376163968   2.572259878607   1.436636083928 AA   -3.863311045488   4.860866691774   2.714848739292 Bohr   0.0
[INPUT] 28 C     -3.761942847301   1.733005962016  -0.084082940611 AA   -7.109041677666   3.274906640448  -0.158893729503 Bohr   0.0
[INPUT] 29 C     -2.032287179401  -0.036182839882  -2.943091349972 AA   -3.840466175532  -0.068375657786  -5.561636611024 Bohr   0.0
[INPUT] 30 C     -3.277254834486   1.490335581110  -1.500188505791 AA   -6.193114077586   2.816326081993  -2.834945411166 Bohr   0.0
[INPUT] 31 H     -4.656454719741  -0.487344107386  -1.079917607985 AA   -8.799424131749  -0.920946891380  -2.040748516187 Bohr   0.0
[INPUT] 32 H     -3.996642151514  -1.361688097991  -2.442269870526 AA   -7.552559084254  -2.573217572283  -4.615221177571 Bohr   0.0
[INPUT] 33 H     -2.475497156698   0.427349312938   2.782348746959 AA   -4.678011648298   0.807573160974   5.257877114780 Bohr   0.0
[INPUT] 34 H     -4.087551744583   1.097822178989   2.522900595000 AA   -7.724353317250   2.074583251762   4.767591164052 Bohr   0.0
[INPUT] 35 C      2.018231894804  -2.524660131703   1.505924321109 AA    3.813905537041  -4.770916206526   2.845784531217 Bohr   0.0
[INPUT] 36 C      3.259116921948  -2.049558056163  -0.542786932779 AA    6.158838390416  -3.873103402544  -1.025718646946 Bohr   0.0
[INPUT] 37 C      3.748273501655  -0.801523934656   1.548818748671 AA    7.083210358093  -1.514660718783   2.926843251580 Bohr   0.0
[INPUT] 38 C      2.044374388744   2.572256739604   1.436640473702 AA    3.863307690802   4.860860759918   2.714857034763 Bohr   0.0
[INPUT] 39 C      3.270632607094   0.549525293642   2.044342383893 AA    6.180599881480   1.038452303504   3.863247210398 Bohr   0.0
[INPUT] 40 C      3.761937580705   1.733004593980  -0.084080762949 AA    7.109031725241   3.274904055236  -0.158889614319 Bohr   0.0
[INPUT] 41 C      2.032289550442  -0.036187192108  -2.943092104283 AA    3.840470656151  -0.068383882301  -5.561638036465 Bohr   0.0
[INPUT] 42 C      3.277249957349   1.490334247155  -1.500186555065 AA    6.193104861131   2.816323561182  -2.834941724828 Bohr   0.0
[INPUT] 43 C      3.748498266908  -0.948652162250  -1.463534302164 AA    7.083635102863  -1.792692774128  -2.765679004996 Bohr   0.0
[INPUT] 44 H     -1.595750475143   3.122348148484   0.612919374615 AA   -3.015531361164   5.900382866178   1.158249754462 Bohr   0.0
[INPUT] 45 H     -1.268264453507   2.296640857269   2.149111869444 AA   -2.396672470649   4.340022226724   4.061232844302 Bohr   0.0
[INPUT] 46 H     -2.781621468451   3.196398605926   1.946665964380 AA   -5.256502757583   6.040317950142   3.678665528690 Bohr   0.0
[INPUT] 47 H     -4.664093531009   1.162486588401   0.127998673519 AA   -8.813859392963   2.196781275558   0.241882437258 Bohr   0.0
[INPUT] 48 H     -4.018276722542   2.784983976448   0.048894602139 AA   -7.593442498318   5.262856976788   0.092397407012 Bohr   0.0
[INPUT] 49 H     -1.579186673654  -1.022457105534  -3.008172189752 AA   -2.984230312769  -1.932163903574  -5.684621574165 Bohr   0.0
[INPUT] 50 H     -1.258844772640   0.722285682822  -3.054365049434 AA   -2.378871853630   1.364922124229  -5.771913427875 Bohr   0.0
[INPUT] 51 H     -2.766408368664   0.092140241800  -3.741759620425 AA   -5.227754165481   0.174119822054  -7.070900906561 Bohr   0.0
[INPUT] 52 H     -2.487025120156   2.196991079501  -1.761092175700 AA   -4.699796342009   4.151711438369  -3.327981892188 Bohr   0.0
[INPUT] 53 H     -4.092814372473   1.623587920372  -2.217222204101 AA   -7.734298242658   3.068136508656  -4.189942723055 Bohr   0.0
[INPUT] 54 H      1.567489534477  -2.082725591711   2.391295304008 AA    2.962125923283  -3.935780960956   4.518893207534 Bohr   0.0
[INPUT] 55 H      1.242444107848  -2.998627123979   0.906486892003 AA    2.347879088913  -5.666584014013   1.713011961393 Bohr   0.0
[INPUT] 56 H      2.748417069976  -3.283569631214   1.796076238705 AA    5.193755538334  -6.205047313933   3.394092189992 Bohr   0.0
[INPUT] 57 H      2.462925691263  -2.623378498356  -1.020937927256 AA    4.654255021642  -4.957466882966  -1.929293072696 Bohr   0.0
[INPUT] 58 H      4.070453027210  -2.743111635382  -0.302440488764 AA    7.692041424333  -5.183729719981  -0.571529692744 Bohr   0.0
[INPUT] 59 H      4.654483461152  -0.706804010281   0.953722280330 AA    8.795698992895  -1.335666003175   1.802273908719 Bohr   0.0
[INPUT] 60 H      3.995010759010  -1.444908513774   2.394569157312 AA    7.549476199220  -2.730481366085   4.525079893650 Bohr   0.0
[INPUT] 61 H      1.595745661349   3.122344774300   0.612925346124 AA    3.015522264412   5.900376489893   1.158261038979 Bohr   0.0
[INPUT] 62 H      1.268266278745   2.296639221816   2.149120841060 AA    2.396675919849   4.340019136167   4.061249798198 Bohr   0.0
[INPUT] 63 H      2.781622983096   3.196394953403   1.946666393171 AA    5.256505619846   6.040311047874   3.678666338988 Bohr   0.0
[INPUT] 64 H      2.475497860876   0.427344893132   2.782351735819 AA    4.678012979003   0.807564808751   5.257882762906 Bohr   0.0
[INPUT] 65 H      4.087550322115   1.097821254353   2.522899839470 AA    7.724350629175   2.074581504453   4.767589736307 Bohr   0.0
[INPUT] 66 H      4.664088987134   1.162486025694   0.127999944204 AA    8.813850806284   2.196780212196   0.241884838506 Bohr   0.0
[INPUT] 67 H      4.018270348659   2.784982765107   0.048897947876 AA    7.593430453426   5.262854687686   0.092403729539 Bohr   0.0
[INPUT] 68 H      1.579190777942  -1.022462211351  -3.008174776091 AA    2.984238068749  -1.932173552171  -5.684626461637 Bohr   0.0
[INPUT] 69 H      1.258846809902   0.722280589083  -3.054368428040 AA    2.378875703496   1.364912498456  -5.771919812514 Bohr   0.0
[INPUT] 70 H      2.766412766351   0.092136366151  -3.741758682492 AA    5.227762475903   0.174112498139  -7.070899134123 Bohr   0.0
[INPUT] 71 H      2.487018451282   2.196987993017  -1.761089326371 AA    4.699783739662   4.151705605760  -3.327976507735 Bohr   0.0
[INPUT] 72 H      4.092809443575   1.623589200858  -2.217219857410 AA    7.734288928390   3.068138928423  -4.189938288451 Bohr   0.0
[INPUT] 73 H      4.656454410628  -0.487341372317  -1.079913215498 AA    8.799423547609  -0.920941722850  -2.040740215589 Bohr   0.0
[INPUT] 74 H      3.996647919157  -1.361686564865  -2.442267685085 AA    7.552569983520  -2.573214675095  -4.615217047687 Bohr   0.0

nuclear repulsion = 4971.98175241531
number of shells = 297
number of NR pGTOs = 1150
number of NR cGTOs = 609
basis = {'default': 'def2tzvp', 'C': '6-31G*', 'H': '6-31G*', 'N': '6-31G*'}
ecp = {}
CPU time:         2.86


******** <class 'pyscf.x2c.sfx2c1e.sfX2C1eROHF'> ********
method = sfX2C1eROHF
initial guess = chk
damping factor = 0
level_shift factor = 0.0
DIIS = <class 'liblan.utils.rdiis.tag_rdiis_.<locals>.RDIIS'>
diis_start_cycle = 1
diis_space = 8
diis_damp = 0
SCF conv_tol = 1e-09
SCF conv_tol_grad = None
SCF max_cycles = 100
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = Cr2O4_rohf.chk
max_memory 200000 MB (current use 137 MB)
num. doubly occ = 129  num. singly occ = 6


******** <class 'pyscf.x2c.sfx2c1e.SpinFreeX2CHelper'> ********
approx = 1e
xuncontract = 1
Set gradient conv threshold to 3.16228e-05
init E= -3356.40543035246
  HOMO = -0.503478161541673  LUMO = -0.187926404123147
cycle= 1 E= -3356.40543035245  delta_E= 1.09e-11  |g|= 2.99e-07  |ddm|= 7.24e-07
  HOMO = -0.503478159585701  LUMO = -0.187926403851753
Extra cycle  E= -3356.40543035245  delta_E= -9.09e-12  |g|= 3.97e-07  |ddm|= 9.61e-07
converged SCF energy = -3356.40543035245
nao =  609
nelec =  (135, 129)
imp_inds.shape (183,)
caoas.shape =  (609, 609)
asorbs =  (np.int64(291), np.int64(135), np.int64(0))
Entanglement S: 0.016
nimp =  183
act_inds =  [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147, 148, 149, 150, 151, 152, 153, 154, 155, 156, 157, 158, 159, 160, 161, 162, 163, 164, 165, 166, 167, 168, 169, 170, 171, 172, 173, 174, 175, 176, 177, 178, 179, 180, 181, 182, 474, 475, 476, 477, 478, 479, 480, 481, 482, 483, 484, 485, 486, 487, 488, 489, 490, 491, 492, 493, 494, 495, 496, 497, 498, 499, 500, 501, 502, 503, 504, 505, 506, 507, 508, 509, 510, 511, 512, 513, 514, 515, 516, 517, 518, 519, 520, 521, 522, 523, 524, 525, 526, 527, 528, 529, 530, 531, 532, 533, 534, 535, 536, 537, 538, 539, 540, 541, 542, 543, 544, 545, 546, 547, 548, 549, 550, 551, 552, 553, 554, 555, 556, 557, 558, 559, 560, 561, 562, 563, 564, 565, 566, 567, 568, 569, 570, 571, 572, 573, 574, 575, 576, 577, 578, 579, 580, 581, 582, 583, 584, 585, 586, 587, 588, 589, 590, 591, 592, 593, 594, 595, 596, 597, 598, 599, 600, 601, 602, 603, 604, 605, 606, 607, 608]
nao =  318
nelec =  (135, 129)


******** <class 'pyscf.x2c.sfx2c1e.sfX2C1eROHF'> ********
method = sfX2C1eROHF
initial guess = 1e
damping factor = 0
level_shift factor = 0.2
DIIS = <class 'pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 8
diis_damp = 0
SCF conv_tol = 1e-09
SCF conv_tol_grad = None
SCF max_cycles = 1000
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = /home/Yxwxwx/code/dmet/test/Cr2/tmp_64298/tmp39dimavc
max_memory 200000 MB (current use 169500 MB)
num. doubly occ = 129  num. singly occ = 6


******** <class 'pyscf.x2c.sfx2c1e.SpinFreeX2CHelper'> ********
approx = 1e
xuncontract = 1
Set gradient conv threshold to 3.16228e-05
init E= -8025.93341275982

WARN: HOMO 0.48543508697174 >= LUMO 0.419195454119253

cycle= 1 E= -8303.98024532307  delta_E= -278  |g|= 6.49  |ddm|= 16.2

WARN: HOMO -0.790004238299945 >= LUMO -0.857702923218217

cycle= 2 E= -8091.85395710805  delta_E=  212  |g|= 30.1  |ddm|= 10.5

WARN: HOMO -0.558441777311975 >= LUMO -0.663467135538206

cycle= 3 E= -8225.22171850379  delta_E= -133  |g|= 21.2  |ddm|= 5.41

WARN: HOMO -0.558627737364042 >= LUMO -0.691411391801562

cycle= 4 E= -8273.39006673666  delta_E= -48.2  |g|= 15.5  |ddm|= 4.27

WARN: HOMO -0.540017170641315 >= LUMO -0.664715066056048

cycle= 5 E= -8294.90540573372  delta_E= -21.5  |g|= 11.8  |ddm|= 2.96
  HOMO = -0.557955723821689  LUMO = -0.485171783074143
cycle= 6 E= -8312.18373655617  delta_E= -17.3  |g|= 8.29  |ddm|=  2.5
  HOMO = -0.562707074944601  LUMO = -0.203792993701467
cycle= 7 E= -8323.5888016243  delta_E= -11.4  |g|= 3.74  |ddm|= 2.54

WARN: HOMO 0.0770838516042219 >= LUMO -0.293140139856726

cycle= 8 E= -8321.11826535431  delta_E= 2.47  |g|= 4.07  |ddm|= 3.73

WARN: HOMO -0.092756093142958 >= LUMO -0.550856766131161

cycle= 9 E= -8325.99444515399  delta_E= -4.88  |g|= 2.59  |ddm|= 3.69

WARN: HOMO 0.133061161555588 >= LUMO -0.406049246004099

cycle= 10 E= -8325.05507409305  delta_E= 0.939  |g|= 2.71  |ddm|= 2.96

WARN: HOMO -0.169912067611261 >= LUMO -0.459474602613968

cycle= 11 E= -8326.15597810845  delta_E= -1.1  |g|= 2.34  |ddm|= 3.15

WARN: HOMO 0.0922058448863694 >= LUMO -0.408163122466675

cycle= 12 E= -8324.84262979404  delta_E= 1.31  |g|=  2.7  |ddm|= 3.15

WARN: HOMO -0.156422080427593 >= LUMO -0.461413331640087

cycle= 13 E= -8326.33943609797  delta_E= -1.5  |g|= 2.18  |ddm|= 3.13

WARN: HOMO -0.0805273453636541 >= LUMO -0.388825479748426

cycle= 14 E= -8326.29016674522  delta_E= 0.0493  |g|= 2.16  |ddm|=  2.8

WARN: HOMO 0.107769244726154 >= LUMO -0.342422763862763

cycle= 15 E= -8324.65908777874  delta_E= 1.63  |g|= 2.77  |ddm|= 3.15

WARN: HOMO 0.00715998742727282 >= LUMO -0.422464640742232

cycle= 16 E= -8324.8021546482  delta_E= -0.143  |g|= 2.66  |ddm|= 3.12

WARN: HOMO 0.00250832530092482 >= LUMO -0.298926018529937

cycle= 17 E= -8324.69141859363  delta_E= 0.111  |g|=  2.8  |ddm|= 3.12

WARN: HOMO -0.00518382520589044 >= LUMO -0.422636499876483

cycle= 18 E= -8325.02177135259  delta_E= -0.33  |g|= 2.58  |ddm|= 3.11

WARN: HOMO -0.103939323016098 >= LUMO -0.335359569696979

cycle= 19 E= -8326.33709359835  delta_E= -1.32  |g|= 2.09  |ddm|= 3.06

WARN: HOMO -0.0735602155901179 >= LUMO -0.413943710799545

cycle= 20 E= -8326.4417683988  delta_E= -0.105  |g|= 2.05  |ddm|= 2.81

WARN: HOMO -0.0804352947726273 >= LUMO -0.243785514154294

cycle= 21 E= -8326.38020673751  delta_E= 0.0616  |g|= 2.11  |ddm|= 2.79

WARN: HOMO -0.0812057802227642 >= LUMO -0.324715957363029

cycle= 22 E= -8327.14876007151  delta_E= -0.769  |g|= 1.52  |ddm|= 2.61

WARN: HOMO -0.0552040927658773 >= LUMO -0.292452962277433

cycle= 23 E= -8327.09273847847  delta_E= 0.056  |g|= 1.68  |ddm|= 2.37

WARN: HOMO -0.0920401433920798 >= LUMO -0.310801067161841

cycle= 24 E= -8327.25727270709  delta_E= -0.165  |g|= 1.46  |ddm|= 2.39

WARN: HOMO -0.0606932417265949 >= LUMO -0.299852801033509

cycle= 25 E= -8327.56985580902  delta_E= -0.313  |g|= 0.944  |ddm|= 2.28

WARN: HOMO -0.177714150041322 >= LUMO -0.337356512961425

cycle= 26 E= -8327.7702192842  delta_E= -0.2  |g|= 0.936  |ddm|= 1.89

WARN: HOMO -0.135204007614189 >= LUMO -0.331877603699285

cycle= 27 E= -8327.7583737302  delta_E= 0.0118  |g|= 1.11  |ddm|=    2

WARN: HOMO -0.0361577792113653 >= LUMO -0.380678115307769

cycle= 28 E= -8326.60596364282  delta_E= 1.15  |g|= 1.94  |ddm|= 2.41

WARN: HOMO 0.000223447398104497 >= LUMO -0.354901653474919

cycle= 29 E= -8326.77310380419  delta_E= -0.167  |g|= 1.86  |ddm|= 2.71

WARN: HOMO -0.0374022699231237 >= LUMO -0.381225218663581

cycle= 30 E= -8326.97813726967  delta_E= -0.205  |g|= 1.67  |ddm|= 2.59

WARN: HOMO 0.0048631522280814 >= LUMO -0.364074583558321

cycle= 31 E= -8327.12607734797  delta_E= -0.148  |g|= 1.57  |ddm|= 2.46

WARN: HOMO -0.0271156524081532 >= LUMO -0.36278050354621

cycle= 32 E= -8327.15338256301  delta_E= -0.0273  |g|= 1.49  |ddm|=  2.5

WARN: HOMO 0.0190387882957256 >= LUMO -0.358481464597939

cycle= 33 E= -8327.05716933648  delta_E= 0.0962  |g|= 1.62  |ddm|= 2.51

WARN: HOMO -0.0105063482095572 >= LUMO -0.353867922211188

cycle= 34 E= -8327.23774190018  delta_E= -0.181  |g|= 1.33  |ddm|= 2.24

WARN: HOMO -0.00259627748949891 >= LUMO -0.386845669809865

cycle= 35 E= -8327.52318083614  delta_E= -0.285  |g|= 1.08  |ddm|= 2.15

WARN: HOMO -0.109575555955193 >= LUMO -0.317559382335099

cycle= 36 E= -8327.53377865568  delta_E= -0.0106  |g|= 1.12  |ddm|= 2.01

WARN: HOMO -0.124500453368343 >= LUMO -0.350271969066287

cycle= 37 E= -8327.85451979075  delta_E= -0.321  |g|= 0.763  |ddm|= 1.93

WARN: HOMO -0.10078403092434 >= LUMO -0.316720960046403

cycle= 38 E= -8327.78195671371  delta_E= 0.0726  |g|= 1.01  |ddm|= 1.96

WARN: HOMO -0.0382474119958792 >= LUMO -0.369815222090348

cycle= 39 E= -8326.99737109057  delta_E= 0.785  |g|= 1.67  |ddm|= 2.19

WARN: HOMO -0.00598590373197779 >= LUMO -0.333654459081885

cycle= 40 E= -8327.11882841984  delta_E= -0.121  |g|= 1.59  |ddm|= 2.65

WARN: HOMO -0.0499499461140824 >= LUMO -0.353729259609017

cycle= 41 E= -8326.97825885439  delta_E= 0.141  |g|= 1.69  |ddm|= 2.55

WARN: HOMO 0.0165477028133895 >= LUMO -0.335583657463731

cycle= 42 E= -8327.332645975  delta_E= -0.354  |g|= 1.36  |ddm|= 2.42

WARN: HOMO -0.0349151811424833 >= LUMO -0.349239661106306

cycle= 43 E= -8327.47752812238  delta_E= -0.145  |g|= 1.21  |ddm|= 2.46

WARN: HOMO 0.0103678118803102 >= LUMO -0.365129734595637

cycle= 44 E= -8327.45404956928  delta_E= 0.0235  |g|= 1.21  |ddm|=  2.3

WARN: HOMO -0.198407450858236 >= LUMO -0.356223987493856

cycle= 45 E= -8327.84230712595  delta_E= -0.388  |g|= 0.921  |ddm|= 2.07

WARN: HOMO -0.0984905488044838 >= LUMO -0.296612108499908

cycle= 46 E= -8327.82675814879  delta_E= 0.0155  |g|= 0.964  |ddm|= 1.98

WARN: HOMO -0.00695725516458809 >= LUMO -0.37342964806727

cycle= 47 E= -8326.38475785108  delta_E= 1.44  |g|= 2.08  |ddm|= 2.44

WARN: HOMO 0.0122110632106108 >= LUMO -0.393919985859918

cycle= 48 E= -8326.80522293548  delta_E= -0.42  |g|=  1.8  |ddm|= 2.73

WARN: HOMO -0.0164326179340778 >= LUMO -0.365593806359021

cycle= 49 E= -8326.56307959008  delta_E= 0.242  |g|= 1.98  |ddm|= 2.75

WARN: HOMO 0.0111427347623389 >= LUMO -0.391150887622427

cycle= 50 E= -8327.22834796644  delta_E= -0.665  |g|=  1.4  |ddm|= 2.35

WARN: HOMO -0.0147863567472709 >= LUMO -0.35625667779065

cycle= 51 E= -8327.04937498822  delta_E= 0.179  |g|= 1.66  |ddm|=  2.7

WARN: HOMO 0.0203432150730621 >= LUMO -0.395471925046924

cycle= 52 E= -8327.33014721291  delta_E= -0.281  |g|= 1.21  |ddm|= 2.51

WARN: HOMO -0.0129916484503767 >= LUMO -0.407011433721415

cycle= 53 E= -8327.35857151185  delta_E= -0.0284  |g|= 1.39  |ddm|= 2.48

WARN: HOMO 0.0281816091257351 >= LUMO -0.427507807436085

cycle= 54 E= -8326.77003956947  delta_E= 0.589  |g|= 1.87  |ddm|= 2.46

WARN: HOMO -0.0859048366382903 >= LUMO -0.311597054882696

cycle= 55 E= -8327.24074598931  delta_E= -0.471  |g|= 1.46  |ddm|= 2.57

WARN: HOMO -0.142243547595414 >= LUMO -0.314046441627192

cycle= 56 E= -8327.53006232879  delta_E= -0.289  |g|=  1.3  |ddm|= 2.43

WARN: HOMO -0.0772019057006771 >= LUMO -0.304537488216137

cycle= 57 E= -8326.46968096731  delta_E= 1.06  |g|= 2.05  |ddm|= 2.45

WARN: HOMO -0.107544362670986 >= LUMO -0.362710556413768

cycle= 58 E= -8327.14766359757  delta_E= -0.678  |g|=  1.5  |ddm|=  2.6

WARN: HOMO -0.054378614911078 >= LUMO -0.305001357388269

cycle= 59 E= -8326.95433745117  delta_E= 0.193  |g|= 1.73  |ddm|= 2.75

WARN: HOMO -0.112636366377092 >= LUMO -0.350237864949552

cycle= 60 E= -8327.29167943599  delta_E= -0.337  |g|= 1.36  |ddm|= 2.28

WARN: HOMO -0.0768841070811857 >= LUMO -0.300313059032163

cycle= 61 E= -8327.06972461072  delta_E= 0.222  |g|= 1.61  |ddm|= 2.65

WARN: HOMO -0.0446867153263466 >= LUMO -0.463782415312813

cycle= 62 E= -8326.88157444501  delta_E= 0.188  |g|= 1.66  |ddm|= 2.47

WARN: HOMO -0.111724051266343 >= LUMO -0.420458520415759

cycle= 63 E= -8326.86746033061  delta_E= 0.0141  |g|= 1.84  |ddm|= 2.76

WARN: HOMO -0.0414923461243448 >= LUMO -0.445169802863986

cycle= 64 E= -8326.82102188523  delta_E= 0.0464  |g|= 1.73  |ddm|= 2.52

WARN: HOMO -0.177576077394604 >= LUMO -0.380304026109775

cycle= 65 E= -8326.9062537074  delta_E= -0.0852  |g|=  1.7  |ddm|= 2.45

WARN: HOMO -0.0981379038139464 >= LUMO -0.448826327868519

cycle= 66 E= -8327.09300459249  delta_E= -0.187  |g|= 1.62  |ddm|= 2.72

WARN: HOMO -0.12756443309839 >= LUMO -0.366221922651166

cycle= 67 E= -8327.01919424616  delta_E= 0.0738  |g|= 1.67  |ddm|=  2.5

WARN: HOMO -0.120541624951439 >= LUMO -0.387477349395032

cycle= 68 E= -8327.23601669671  delta_E= -0.217  |g|= 1.37  |ddm|= 2.58

WARN: HOMO -0.147344654931332 >= LUMO -0.315089119295693

cycle= 69 E= -8327.80581686479  delta_E= -0.57  |g|= 0.787  |ddm|= 2.16
  HOMO = -0.270263626152521  LUMO = -0.185606004483971
cycle= 70 E= -8327.8926334445  delta_E= -0.0868  |g|= 0.764  |ddm|= 0.563

WARN: HOMO -0.161907060555351 >= LUMO -0.268712874717691

cycle= 71 E= -8328.23455494756  delta_E= -0.342  |g|= 0.317  |ddm|= 1.44
  HOMO = -0.329434459583023  LUMO = -0.0691009865793748
cycle= 72 E= -8328.32618855639  delta_E= -0.0916  |g|= 0.193  |ddm|= 0.406
  HOMO = -0.365337720812842  LUMO = 0.0194576035545571
cycle= 73 E= -8328.35676658649  delta_E= -0.0306  |g|= 0.11  |ddm|= 0.242
  HOMO = -0.40082291949298  LUMO = 0.0637909992836993
cycle= 74 E= -8328.37312986101  delta_E= -0.0164  |g|= 0.0627  |ddm|= 0.23
  HOMO = -0.39381315607104  LUMO = 0.0720386936670592
cycle= 75 E= -8328.37867510881  delta_E= -0.00555  |g|= 0.043  |ddm|= 0.112
  HOMO = -0.400471763926686  LUMO = 0.0732258266969063
cycle= 76 E= -8328.38250701555  delta_E= -0.00383  |g|= 0.0332  |ddm|= 0.11
  HOMO = -0.403365428839819  LUMO = 0.0777573427190684
cycle= 77 E= -8328.38539586978  delta_E= -0.00289  |g|= 0.0221  |ddm|= 0.122
  HOMO = -0.403986100012099  LUMO = 0.0779030749795606
cycle= 78 E= -8328.38646714881  delta_E= -0.00107  |g|= 0.0155  |ddm|= 0.0754
  HOMO = -0.403771874513158  LUMO = 0.0772384758647274
cycle= 79 E= -8328.38700544263  delta_E= -0.000538  |g|= 0.00634  |ddm|= 0.0716
  HOMO = -0.403615538892483  LUMO = 0.0771169604277537
cycle= 80 E= -8328.38709511949  delta_E= -8.97e-05  |g|= 0.00325  |ddm|= 0.0184
  HOMO = -0.403624539109603  LUMO = 0.0772275318906499
cycle= 81 E= -8328.3871281707  delta_E= -3.31e-05  |g|= 0.00259  |ddm|= 0.0101
  HOMO = -0.403656013719785  LUMO = 0.0772599933507368
cycle= 82 E= -8328.38715951208  delta_E= -3.13e-05  |g|= 0.00169  |ddm|= 0.0136
  HOMO = -0.403420998298395  LUMO = 0.0772523352200412
cycle= 83 E= -8328.38717736594  delta_E= -1.79e-05  |g|= 0.000861  |ddm|= 0.0121
  HOMO = -0.403523621803631  LUMO = 0.077233247840641
cycle= 84 E= -8328.38718110605  delta_E= -3.74e-06  |g|= 0.000437  |ddm|= 0.00495
  HOMO = -0.403450599547303  LUMO = 0.0772674449814555
cycle= 85 E= -8328.38718249236  delta_E= -1.39e-06  |g|= 0.000217  |ddm|= 0.00382
  HOMO = -0.403477527267904  LUMO = 0.0772559261236185
cycle= 86 E= -8328.3871826841  delta_E= -1.92e-07  |g|= 0.000106  |ddm|= 0.00126
  HOMO = -0.403471901045854  LUMO = 0.0772532432733984
cycle= 87 E= -8328.3871827326  delta_E= -4.85e-08  |g|= 7.17e-05  |ddm|= 0.000624
  HOMO = -0.403479106923446  LUMO = 0.0772511883558183
cycle= 88 E= -8328.3871827521  delta_E= -1.95e-08  |g|= 4.33e-05  |ddm|= 0.000399
  HOMO = -0.403477451682435  LUMO = 0.0772509539346094
cycle= 89 E= -8328.38718276101  delta_E= -8.92e-09  |g|= 2.74e-05  |ddm|= 0.000231
  HOMO = -0.4034783899835  LUMO = 0.0772507497155462
cycle= 90 E= -8328.38718276499  delta_E= -3.98e-09  |g|= 1.87e-05  |ddm|= 0.000166
  HOMO = -0.403478210677213  LUMO = 0.0772507933198187
cycle= 91 E= -8328.38718276688  delta_E= -1.89e-09  |g|= 9.42e-06  |ddm|= 0.000118
  HOMO = -0.403478575927676  LUMO = 0.0772505165592222
cycle= 92 E= -8328.38718276748  delta_E= -5.98e-10  |g|= 5.56e-06  |ddm|= 6.67e-05
  HOMO = -0.503477941965232  LUMO = -0.122749164104658
Extra cycle  E= -8328.38718276756  delta_E= -8.37e-11  |g|= 5.31e-06  |ddm|= 1.7e-05
converged SCF energy = -8328.38718276756
Attempting SA-DMRGSCF with
10 states with spin multiplicity 1
10 states with spin multiplicity 3
10 states with spin multiplicity 5
10 states with spin multiplicity 7

******** <class 'pyscf.mcscf.addons.StateAverageCASSCF'> ********
CAS (6e+0e, 10o), ncore = 129, nvir = 179
max_cycle_macro = 50
max_cycle_micro = 4
conv_tol = 1e-07
conv_tol_grad = None
orbital rotation max_stepsize = 0.02
orbital rotation threshold for CI restart = 0.01
augmented hessian ah_max_cycle = 30
augmented hessian ah_conv_tol = 1e-12
augmented hessian ah_linear dependence = 1e-14
augmented hessian ah_level shift = 1e-08
augmented hessian ah_start_tol = 2.5
augmented hessian ah_start_cycle = 3
augmented hessian ah_grad_trust_region = 3
kf_trust_region = 3
kf_interval = 4
ci_response_space = 4
ci_grad_trust_region = 3
with_dep4 0
natorb = False
canonicalization = True
sorting_mo_energy = False
ao2mo_level = 2
chkfile = /home/Yxwxwx/code/dmet/test/Cr2/tmp_64298/tmp39dimavc
max_memory 200000 MB (current use 169501 MB)
internal_rotation = False

******** Block flags ********
executable             = /home/Yxwxwx/.conda/envs/my_pyscf/bin/block2main
BLOCKEXE_COMPRESS_NEVPT= /path/to/serially/compiled/Block/block.spin_adapted
Block version          = 2.0
mpiprefix              =  
scratchDirectory       = /home/Yxwxwx/code/dmet/test/Cr2/tmp_64298/0
integralFile           = /home/Yxwxwx/code/dmet/test/Cr2/tmp_64298/0/FCIDUMP
configFile             = /home/Yxwxwx/code/dmet/test/Cr2/tmp_64298/0/dmrg.conf
outputFile             = /home/Yxwxwx/code/dmet/test/Cr2/tmp_64298/0/dmrg.out
maxIter                = 38
scheduleSweeps         = [0, 4, 8, 12, 14, 16, 18, 20, 22, 24, 26]
scheduleMaxMs          = [200, 400, 800, 1500, 1500, 1500, 1500, 1500, 1500, 1500, 1500]
scheduleTols           = [0.0001, 0.0001, 0.0001, 0.0001, 1e-05, 1.0000000000000002e-06, 1.0000000000000002e-07, 1.0000000000000002e-08, 1.0000000000000003e-09, 1.0000000000000003e-10, 1.0000000000000001e-11]
scheduleNoises         = [0.0001, 0.0001, 0.0001, 0.0001, 1e-05, 1.0000000000000002e-06, 1.0000000000000002e-07, 1.0000000000000002e-08, 1.0000000000000003e-09, 1.0000000000000003e-10, 0.0]
twodot_to_onedot       = 30
tol                    = 1e-10
maxM                   = 1500
dmrg switch tol        = 0.001
wfnsym                 = 1
fullrestart            = False
num_thrds              = 32
memory                 = 200

State-average over 40 states with weights [0.025 0.025 0.025 0.025 0.025 0.025 0.025 0.025 0.025 0.025 0.025 0.025
 0.025 0.025 0.025 0.025 0.025 0.025 0.025 0.025 0.025 0.025 0.025 0.025
 0.025 0.025 0.025 0.025 0.025 0.025 0.025 0.025 0.025 0.025 0.025 0.025
 0.025 0.025 0.025 0.025]
CASCI E = -8328.24673498006  S^2 = 5.0000000
Set conv_tol_grad to 0.000316228
macro iter   1 ( 21 JK    4 micro), CASSCF E = -8328.28031437531  dE = -3.35793953e-02  S^2 = 5.0000000
               |grad[o]|=0.0563  |ddm|=0.103  |maxRot[o]|=0.314
macro iter   2 ( 21 JK    4 micro), CASSCF E = -8328.30249107224  dE = -2.21766969e-02  S^2 = 5.0000000
               |grad[o]|=0.0587  |ddm|=0.168  |maxRot[o]|=0.314
macro iter   3 ( 11 JK    4 micro), CASSCF E = -8328.30340551844  dE = -9.14446204e-04  S^2 = 5.0000000
               |grad[o]|=0.0308  |ddm|=0.0284  |maxRot[o]|=0.0544
macro iter   4 (  9 JK    4 micro), CASSCF E = -8328.30340646489  dE = -9.46451109e-07  S^2 = 5.0000000
               |grad[o]|=0.000919  |ddm|=0.0131  |maxRot[o]|=0.000216
macro iter   5 (  3 JK    1 micro), CASSCF E = -8328.30340654969  dE = -8.47976480e-08  S^2 = 5.0000000
               |grad[o]|=0.000446  |ddm|=0.00243  |maxRot[o]|=3.71e-05
macro iter   6 (  3 JK    1 micro), CASSCF E = -8328.30340660148  dE = -5.17866283e-08  S^2 = 5.0000000
               |grad[o]|=0.00036  |ddm|=0.00195  |maxRot[o]|=2.8e-05
macro iter   7 (  3 JK    1 micro), CASSCF E = -8328.30340663482  dE = -3.33475327e-08  S^2 = 5.0000000
               |grad[o]|=0.000294  |ddm|=0.00151  |maxRot[o]|=2.27e-05
macro iter   8 (  3 JK    1 micro), CASSCF E = -8328.30340665536  dE = -2.05382094e-08  S^2 = 5.0000000
               |grad[o]|=0.000229  |ddm|=0.0012  |maxRot[o]|=1.72e-05
macro iter   9 (  3 JK    1 micro), CASSCF E = -8328.30340666832  dE = -1.29584805e-08  S^2 = 5.0000000
               |grad[o]|=0.000183  |ddm|=0.000948  |maxRot[o]|=1.37e-05
macro iter  10 (  3 JK    1 micro), CASSCF E = -8328.30340667632  dE = -7.99991540e-09  S^2 = 5.0000000
               |grad[o]|=0.000143  |ddm|=0.000735  |maxRot[o]|=1.07e-05
1-step CASSCF converged in  10 macro ( 80 JK  22 micro) steps
CASSCF canonicalization
Density matrix diagonal elements [0.91926323 0.86924196 0.86904402 0.85515224 0.85090662 0.85141586
 0.19905488 0.19212534 0.20215544 0.19164041]
CASSCF energy = -8328.30340667632
CASCI E = -8328.30340667632  E(CI) = -11.8964680093231  S^2 = 5.0000000
CASCI state-averaged energy = -8328.30340667632
CASCI energy for each state
  State 0 weight 0.025  E = -8328.38708045306 S^2 = 0.0000000
  State 1 weight 0.025  E = -8328.30187479795 S^2 = 0.0000000
  State 2 weight 0.025  E = -8328.30180098654 S^2 = 0.0000000
  State 3 weight 0.025  E = -8328.30165188396 S^2 = 0.0000000
  State 4 weight 0.025  E = -8328.30158168076 S^2 = 0.0000000
  State 5 weight 0.025  E = -8328.30061502501 S^2 = 0.0000000
  State 6 weight 0.025  E = -8328.30037703213 S^2 = 0.0000000
  State 7 weight 0.025  E = -8328.26568237329 S^2 = 0.0000000
  State 8 weight 0.025  E = -8328.26534359295 S^2 = 0.0000000
  State 9 weight 0.025  E = -8328.25576781918 S^2 = 0.0000000
  State 10 weight 0.025  E = -8328.38700089586 S^2 = 2.0000000
  State 11 weight 0.025  E = -8328.30184810774 S^2 = 2.0000000
  State 12 weight 0.025  E = -8328.30177436614 S^2 = 2.0000000
  State 13 weight 0.025  E = -8328.30162396261 S^2 = 2.0000000
  State 14 weight 0.025  E = -8328.30155490584 S^2 = 2.0000000
  State 15 weight 0.025  E = -8328.30051228208 S^2 = 2.0000000
  State 16 weight 0.025  E = -8328.30027601098 S^2 = 2.0000000
  State 17 weight 0.025  E = -8328.29823127709 S^2 = 2.0000000
  State 18 weight 0.025  E = -8328.29819450123 S^2 = 2.0000000
  State 19 weight 0.025  E = -8328.29811911669 S^2 = 2.0000000
  State 20 weight 0.025  E = -8328.38684036929 S^2 = 6.0000000
  State 21 weight 0.025  E = -8328.30178939166 S^2 = 6.0000000
  State 22 weight 0.025  E = -8328.30171581938 S^2 = 6.0000000
  State 23 weight 0.025  E = -8328.30156222137 S^2 = 6.0000000
  State 24 weight 0.025  E = -8328.3014955569 S^2 = 6.0000000
  State 25 weight 0.025  E = -8328.30030845177 S^2 = 6.0000000
  State 26 weight 0.025  E = -8328.30007252066 S^2 = 6.0000000
  State 27 weight 0.025  E = -8328.29788910642 S^2 = 6.0000000
  State 28 weight 0.025  E = -8328.29785690758 S^2 = 6.0000000
  State 29 weight 0.025  E = -8328.29766456241 S^2 = 6.0000000
  State 30 weight 0.025  E = -8328.38659593509 S^2 = 12.0000000
  State 31 weight 0.025  E = -8328.3016875024 S^2 = 12.0000000
  State 32 weight 0.025  E = -8328.30161420131 S^2 = 12.0000000
  State 33 weight 0.025  E = -8328.30145773153 S^2 = 12.0000000
  State 34 weight 0.025  E = -8328.30139479119 S^2 = 12.0000000
  State 35 weight 0.025  E = -8328.30000721757 S^2 = 12.0000000
  State 36 weight 0.025  E = -8328.29976412871 S^2 = 12.0000000
  State 37 weight 0.025  E = -8328.26524259154 S^2 = 12.0000000
  State 38 weight 0.025  E = -8328.26487940649 S^2 = 12.0000000
  State 39 weight 0.025  E = -8328.25551756849 S^2 = 12.0000000
Initializing 4c-HF with Gaunt with gauge for H atom.
Maximum memory cost (2e part) in SCF and amfi calculation: 4.57764e-05 GB.
1e-integrals time (CPU/WALL): 0.00/0.00 seconds.
2e-Coulomb-integrals time (CPU/WALL): 0.00/0.00 seconds.
2e-Gaunt-integrals time (CPU/WALL): 0.00/0.00 seconds.
2e-gauge-integrals time (CPU/WALL): 0.12/0.00 seconds.

Start Dirac Hartree-Fock iterations...
with SCF convergence = 1e-09

Special treatment for fractional occupation of H atom.

SCF converges after 1 iterations.

Final DHF energy is -0.340081496312782 hartree.
DHF iterations time (CPU/WALL): 0.00/0.00 seconds.
2e-SO Coulomb integrals time (CPU/WALL): 0.00/0.00 seconds.
Initializing 4c-HF with Gaunt with gauge for O atom.
Maximum memory cost (2e part) in SCF and amfi calculation: 0.00736874341964722 GB.
1e-integrals time (CPU/WALL): 0.00/0.00 seconds.
2e-Coulomb-integrals time (CPU/WALL): 1.28/0.04 seconds.
2e-Gaunt-integrals time (CPU/WALL): 0.99/0.04 seconds.
2e-gauge-integrals time (CPU/WALL): 1.10/0.15 seconds.

Start Dirac Hartree-Fock iterations...
with SCF convergence = 1e-09


SCF converges after 12 iterations.

Final DHF energy is -74.3428623370862 hartree.
DHF iterations time (CPU/WALL): 0.02/0.02 seconds.
2e-SO Coulomb integrals time (CPU/WALL): 0.06/0.06 seconds.
Initializing 4c-HF with Gaunt with gauge for CR atom.
Maximum memory cost (2e part) in SCF and amfi calculation: 0.0711967349052429 GB.
1e-integrals time (CPU/WALL): 0.00/0.00 seconds.
2e-Coulomb-integrals time (CPU/WALL): 0.34/0.34 seconds.
2e-Gaunt-integrals time (CPU/WALL): 0.25/0.25 seconds.
2e-gauge-integrals time (CPU/WALL): 1.27/1.27 seconds.

Start Dirac Hartree-Fock iterations...
with SCF convergence = 1e-09


SCF converges after 21 iterations.

Final DHF energy is -1048.37272881635 hartree.
DHF iterations time (CPU/WALL): 0.09/0.09 seconds.
2e-SO Coulomb integrals time (CPU/WALL): 0.48/0.48 seconds.
Initializing 4c-HF with Gaunt with gauge for C atom.
Maximum memory cost (2e part) in SCF and amfi calculation: 0.00321078300476074 GB.
1e-integrals time (CPU/WALL): 0.00/0.00 seconds.
2e-Coulomb-integrals time (CPU/WALL): 0.02/0.02 seconds.
2e-Gaunt-integrals time (CPU/WALL): 0.02/0.02 seconds.
2e-gauge-integrals time (CPU/WALL): 0.06/0.06 seconds.

Start Dirac Hartree-Fock iterations...
with SCF convergence = 1e-09


SCF converges after 10 iterations.

Final DHF energy is -37.3324964757747 hartree.
DHF iterations time (CPU/WALL): 0.01/0.01 seconds.
2e-SO Coulomb integrals time (CPU/WALL): 0.03/0.03 seconds.
Initializing 4c-HF with Gaunt with gauge for N atom.
Maximum memory cost (2e part) in SCF and amfi calculation: 0.00321078300476074 GB.
1e-integrals time (CPU/WALL): 0.00/0.00 seconds.
2e-Coulomb-integrals time (CPU/WALL): 0.02/0.02 seconds.
2e-Gaunt-integrals time (CPU/WALL): 0.02/0.02 seconds.
2e-gauge-integrals time (CPU/WALL): 0.06/0.06 seconds.

Start Dirac Hartree-Fock iterations...
with SCF convergence = 1e-09


SCF converges after 10 iterations.

Final DHF energy is -53.8528938424878 hartree.
DHF iterations time (CPU/WALL): 0.01/0.01 seconds.
2e-SO Coulomb integrals time (CPU/WALL): 0.03/0.03 seconds.
mo_cas.shape =  (609, 10)
sodm1.shape =  (609, 609)
xdmao.shape =  (1150, 1150)
hso1e.shape =  (3, 609, 609)
hso2e.shape =  (3, 609, 609)
hso.shape =  (3, 10, 10)
total time elapsed: 5393.06s
